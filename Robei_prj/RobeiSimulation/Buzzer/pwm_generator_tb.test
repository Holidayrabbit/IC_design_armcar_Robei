<!DOCTYPE Robei>
<Module X="0" Class="module" Type="testbench" Width="900" Time_Scale="" Name="pwm_generator_tb" Code="&#xa;&#x9;initial Clk = 0;&#xa;&#x9;always #1 Clk = ~Clk;&#xa;&#x9;&#xa;&#x9;initial begin&#xa;&#x9;&#x9;Rst_n = 0;&#xa;&#x9;&#x9;pwm_gen_en = 0;&#xa;&#x9;&#x9;counter_arr = 0;&#xa;&#x9;&#x9;counter_ccr = 0;&#xa;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;Rst_n = 1;&#xa;&#x9;&#x9;#20;&#xa;&#xa;&#x9;&#x9;counter_arr = 1000; //设置输出信号频率为50KHz&#xa;&#x9;&#x9;counter_ccr = 400; //设置输出PWM波占空比为40%&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;pwm_gen_en = 1;&#x9;   //启动计数以产生PWM输出&#xa;&#x9;&#x9;#100000;&#xa;&#xa;&#x9;&#x9;counter_ccr = 700; //设置输出PWM波占空比为70%&#xa;&#x9;&#x9;#100000;&#xa;&#x9;&#x9;pwm_gen_en = 0;&#x9;   //停止计数以关闭PWM输出&#xa;    &#xa;&#x9;&#x9;counter_arr = 500; //设置输出信号频率为100KHz&#xa;&#x9;&#x9;counter_ccr = 250; //设置输出PWM波占空比为50%&#xa;&#x9;&#x9;#100000;&#xa;&#x9;&#x9;pwm_gen_en = 1;&#x9;   //启动计数以产生PWM输出&#xa;&#x9;&#x9;#50000;&#xa;&#x9;&#x9;counter_ccr = 100; //设置输出PWM波占空比为20%&#xa;&#x9;&#x9;#50000;&#xa;&#x9;&#x9;pwm_gen_en = 0;&#x9;   //停止计数以关闭PWM输出&#xa;&#xa;&#x9;&#x9;#200;&#xa;&#x9;&#x9;$finish;&#xa;&#x9;end&#xa;" Color="#d3d3d3" Y="0" Include="" Parent="0" Comment="" Height="600" File="Current/pwm_generator_tb.test">
 <Module X="336.972" Class="pwm_generator" Type="model" Width="160" Parameters="" Name="pwm_generator1" Code="&#xa;&#x9;&#xa;&#x9;&#xa;&#x9;&#x9;reg [31:0]pwm_gen_cnt;   //定义32位产生pwm的计数器&#xa;&#x9;&#xa;&#x9;&#x9;always@(posedge Clk or posedge Rst_n)&#xa;&#x9;&#x9;if(!Rst_n )&#xa;&#x9;&#x9;&#x9;pwm_gen_cnt &lt;= 32'd1;&#xa;&#x9;&#x9;else if(pwm_gen_en)&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;if(pwm_gen_cnt &lt;= 32'd1)&#xa;&#x9;&#x9;&#x9;&#x9;pwm_gen_cnt &lt;= counter_arr;       //计数减到1，加载预重装寄存器值&#xa;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;pwm_gen_cnt &lt;= pwm_gen_cnt - 1'b1;//计数器自减1&#xa;&#x9;&#x9;end&#xa;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;pwm_gen_cnt &lt;= counter_arr;&#x9;        //未使能时，计数器值等于预重装寄存器值&#xa;&#x9;&#xa;&#x9;&#x9;always@(posedge Clk or posedge Rst_n)&#xa;&#x9;&#x9;if(!Rst_n )                          //复位时，PWM输出低电平&#xa;&#x9;&#x9;&#x9;pwm_out &lt;= 1'b0;&#xa;&#x9;&#x9;else if(pwm_gen_cnt &lt;= counter_ccr)   //计数值小于比较值，PWM输出高电平&#xa;&#x9;&#x9;&#x9;pwm_out &lt;= 1'b1;&#xa;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;pwm_out &lt;= 1'b0;                    //计数值大于比较值，PWM输出低电平" Color="#d3d3d3" Y="256.468" Include="" Parent="pwm_generator_tb" Comment="" Height="160" File="Current/pwm_generator.model">
  <Port X="-0.125" Datatype="wire" Width="20" Function="" Name="Clk" Datasize="1" Color="#faebd7" Y="0.075" Parent="pwm_generator1" Height="20" Inout="input" Connect="" Side="left"/>
  <Port X="-0.125" Datatype="wire" Width="20" Function="" Name="Rst_n" Datasize="1" Color="#00ffff" Y="0.2125" Parent="pwm_generator1" Height="20" Inout="input" Connect="" Side="left"/>
  <Port X="-0.125" Datatype="wire" Width="20" Function="" Name="pwm_gen_en" Datasize="1" Color="#7fffd4" Y="0.35" Parent="pwm_generator1" Height="20" Inout="input" Connect="" Side="left"/>
  <Port X="-0.125" Datatype="wire" Width="20" Function="" Name="counter_arr" Datasize="32" Color="#f0ffff" Y="0.4875" Parent="pwm_generator1" Height="20" Inout="input" Connect="" Side="left"/>
  <Port X="-0.125" Datatype="wire" Width="20" Function="" Name="counter_ccr" Datasize="32" Color="#f5f5dc" Y="0.625" Parent="pwm_generator1" Height="20" Inout="input" Connect="" Side="left"/>
  <Port X="0.875" Datatype="reg" Width="20" Function="" Name="pwm_out" Datasize="1" Color="#ffe4c4" Y="0.26875" Parent="pwm_generator1" Height="20" Inout="output" Connect="" Side="right"/>
 </Module>
 <Port X="-0.0222222" Datatype="reg" Width="20" Function="" Name="Clk" Datasize="1" Color="#faebd7" Y="0.125" Parent="pwm_generator_tb" Height="20" Inout="input" Side="left"/>
 <Port X="-0.0222222" Datatype="reg" Width="20" Function="" Name="Rst_n" Datasize="1" Color="#00ffff" Y="0.266667" Parent="pwm_generator_tb" Height="20" Inout="input" Side="left"/>
 <Port X="-0.0222222" Datatype="reg" Width="20" Function="" Name="pwm_gen_en" Datasize="1" Color="#7fffd4" Y="0.408333" Parent="pwm_generator_tb" Height="20" Inout="input" Side="left"/>
 <Port X="-0.0222222" Datatype="reg" Width="20" Function="" Name="counter_arr" Datasize="32" Color="#f0ffff" Y="0.55" Parent="pwm_generator_tb" Height="20" Inout="input" Side="left"/>
 <Port X="-0.0222222" Datatype="reg" Width="20" Function="" Name="counter_ccr" Datasize="32" Color="#f5f5dc" Y="0.691667" Parent="pwm_generator_tb" Height="20" Inout="input" Side="left"/>
 <Port X="0.977778" Datatype="wire" Width="20" Function="" Name="pwm_out" Datasize="1" Color="#ffe4c4" Y="0.316667" Parent="pwm_generator_tb" Height="20" Inout="output" Side="right"/>
 <Wire Datatype="wire" From="pwm_generator_tb>Clk" To="pwm_generator_tb#pwm_generator1>Clk" Name="pwm_generator_tb_Clk" Datasize="1" Parent="pwm_generator_tb"/>
 <Wire Datatype="wire" From="pwm_generator_tb>Rst_n" To="pwm_generator_tb#pwm_generator1>Rst_n" Name="pwm_generator_tb_Rst_n" Datasize="1" Parent="pwm_generator_tb"/>
 <Wire Datatype="wire" From="pwm_generator_tb>pwm_gen_en" To="pwm_generator_tb#pwm_generator1>pwm_gen_en" Name="pwm_generator_tb_pwm_gen_en" Datasize="1" Parent="pwm_generator_tb"/>
 <Wire Datatype="wire" From="pwm_generator_tb>counter_arr" To="pwm_generator_tb#pwm_generator1>counter_arr" Name="pwm_generator_tb_counter_arr" Datasize="32" Parent="pwm_generator_tb"/>
 <Wire Datatype="wire" From="pwm_generator_tb>counter_ccr" To="pwm_generator_tb#pwm_generator1>counter_ccr" Name="pwm_generator_tb_counter_ccr" Datasize="32" Parent="pwm_generator_tb"/>
 <Wire Datatype="wire" From="pwm_generator_tb#pwm_generator1>pwm_out" To="pwm_generator_tb>pwm_out" Name="pwm_generator1_pwm_out" Datasize="1" Parent="pwm_generator_tb"/>
</Module>
