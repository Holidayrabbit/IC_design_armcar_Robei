<!DOCTYPE Robei>
<Module Y="0" Width="900" Parameters="" Parent="0" Height="600" Type="module" Code="&#xa;&#x9;&#x9;parameter DATA_WIDTH = 80;&#xa;&#x9;&#x9;parameter MSB_FIRST = 1;&#xa;&#x9;&#xa;&#x9;&#x9;reg [DATA_WIDTH-1 : 0]data_r;         //这里得改&#xa;&#x9;&#xa;&#x9;&#x9;reg [7:0] data_byte;&#xa;&#x9;&#x9;reg byte_send_en;&#xa;&#x9;&#x9;wire byte_tx_done;&#xa;&#x9;&#xa;&#x9;&#x9;reg [8:0]cnt;&#xa;&#x9;&#x9;reg [1:0]state;&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;localparam S0 = 0;&#x9;//等待发送请求&#xa;&#x9;&#x9;localparam S1 = 1;&#x9;//发起单字节数据发送&#xa;&#x9;&#x9;localparam S2 = 2;&#x9;//等待单字节数据发送完成&#xa;&#x9;&#x9;localparam S3 = 3;&#x9;//检查所有数据是否发送完成&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;&#x9;if(!Rst_n)begin&#xa;&#x9;&#x9;&#x9;data_byte &lt;= 0;&#xa;&#x9;&#x9;&#x9;byte_send_en &lt;= 0;&#xa;&#x9;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;end&#xa;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;case(state)&#xa;&#x9;&#x9;&#x9;&#x9;S0: &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if(send_en)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;S1:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;byte_send_en &lt;= 1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if(MSB_FIRST == 1)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= data_r[DATA_WIDTH-1:DATA_WIDTH - 8];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r &lt;&lt; 8;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= data_r[7:0];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r >> 8;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S2;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;S2:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;byte_send_en &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if(byte_tx_done)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S3;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= cnt + 9'd8;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S2;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;S3:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(cnt >= DATA_WIDTH)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;default:state &lt;= S0;&#xa;&#x9;&#x9;&#x9;endcase&#x9;&#xa;&#x9;&#x9;end&#xa;&#x9;&#xa;&#x9;&#xa;&#x9;&#xa;&#xa;&#xa;&#xa;&#xa;" X="0" Class="module" Comment="" Color="#d3d3d3" Include="" File="Current/uart_data_tx.model" Name="uart_data_tx">
 <Module Y="274.613" Width="160" Parameters="" Parent="uart_data_tx" Height="160" Type="model" Code="&#x9;localparam START_BIT = 1'b0;&#xa;&#x9;localparam STOP_BIT = 1'b1; &#xa;&#x9;&#xa;&#x9;reg bps_clk;&#x9;     //波特率时钟&#x9;&#xa;&#x9;reg [15:0]div_cnt;      //分频计数器&#x9;&#xa;&#x9;reg [15:0]bps_DR;       //分频计数最大值&#x9;&#xa;&#x9;reg [3:0]bps_cnt;      //波特率时钟计数器&#x9;&#xa;&#x9;reg [7:0]data_byte_reg;//data_byte寄存后数据&#xa;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;uart_state &lt;= 1'b0;&#xa;&#x9;else if(send_en)&#xa;&#x9;&#x9;uart_state &lt;= 1'b1;&#xa;&#x9;else if(bps_cnt == 4'd11)&#xa;&#x9;&#x9;uart_state &lt;= 1'b0;&#xa;&#x9;else&#xa;&#x9;&#x9;uart_state &lt;= uart_state;&#xa;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;data_byte_reg &lt;= 8'd0;&#xa;&#x9;else if(send_en)&#xa;&#x9;&#x9;data_byte_reg &lt;= data_byte;&#xa;&#x9;else&#xa;&#x9;&#x9;data_byte_reg &lt;= data_byte_reg;&#xa;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;bps_DR &lt;= 16'd5207;&#xa;&#x9;else begin&#xa;&#x9;&#x9;case(Baud_Set)&#xa;&#x9;&#x9;&#x9;0:bps_DR &lt;= 16'd5207;&#xa;&#x9;&#x9;&#x9;1:bps_DR &lt;= 16'd2603;&#xa;&#x9;&#x9;&#x9;2:bps_DR &lt;= 16'd1301;&#xa;&#x9;&#x9;&#x9;3:bps_DR &lt;= 16'd867;&#xa;&#x9;&#x9;&#x9;4:bps_DR &lt;= 16'd433;&#xa;&#x9;&#x9;&#x9;default:bps_DR &lt;= 16'd5207;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;endcase&#xa;&#x9;end&#x9;&#xa;&#x9;&#xa;&#x9;//counter&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;div_cnt &lt;= 16'd0;&#xa;&#x9;else if(uart_state)begin&#xa;&#x9;&#x9;if(div_cnt == bps_DR)&#xa;&#x9;&#x9;&#x9;div_cnt &lt;= 16'd0;&#xa;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;div_cnt &lt;= div_cnt + 1'b1;&#xa;&#x9;end&#xa;&#x9;else&#xa;&#x9;&#x9;div_cnt &lt;= 16'd0;&#xa;&#x9;&#xa;&#x9;// bps_clk gen&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;bps_clk &lt;= 1'b0;&#xa;&#x9;else if(div_cnt == 16'd1)&#xa;&#x9;&#x9;bps_clk &lt;= 1'b1;&#xa;&#x9;else&#xa;&#x9;&#x9;bps_clk &lt;= 1'b0;&#xa;&#x9;&#xa;&#x9;//bps counter&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#x9;&#xa;&#x9;&#x9;bps_cnt &lt;= 4'd0;&#xa;&#x9;else if(bps_cnt == 4'd11)&#xa;&#x9;&#x9;bps_cnt &lt;= 4'd0;&#xa;&#x9;else if(bps_clk)&#xa;&#x9;&#x9;bps_cnt &lt;= bps_cnt + 1'b1;&#xa;&#x9;else&#xa;&#x9;&#x9;bps_cnt &lt;= bps_cnt;&#xa;&#x9;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;Tx_Done &lt;= 1'b0;&#xa;&#x9;else if(bps_cnt == 4'd11)&#xa;&#x9;&#x9;Tx_Done &lt;= 1'b1;&#xa;&#x9;else&#xa;&#x9;&#x9;Tx_Done &lt;= 1'b0;&#xa;&#x9;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;uart_tx &lt;= 1'b1;&#xa;&#x9;else begin&#xa;&#x9;&#x9;case(bps_cnt)&#xa;&#x9;&#x9;&#x9;0:uart_tx &lt;= 1'b1;&#xa;&#x9;&#x9;&#x9;1:uart_tx &lt;= START_BIT;&#xa;&#x9;&#x9;&#x9;2:uart_tx &lt;= data_byte_reg[0];&#xa;&#x9;&#x9;&#x9;3:uart_tx &lt;= data_byte_reg[1];&#xa;&#x9;&#x9;&#x9;4:uart_tx &lt;= data_byte_reg[2];&#xa;&#x9;&#x9;&#x9;5:uart_tx &lt;= data_byte_reg[3];&#xa;&#x9;&#x9;&#x9;6:uart_tx &lt;= data_byte_reg[4];&#xa;&#x9;&#x9;&#x9;7:uart_tx &lt;= data_byte_reg[5];&#xa;&#x9;&#x9;&#x9;8:uart_tx &lt;= data_byte_reg[6];&#xa;&#x9;&#x9;&#x9;9:uart_tx &lt;= data_byte_reg[7];&#xa;&#x9;&#x9;&#x9;10:uart_tx &lt;= STOP_BIT;&#xa;&#x9;&#x9;&#x9;default:uart_tx &lt;= 1'b1;&#xa;&#x9;&#x9;endcase&#xa;&#x9;end&#x9;&#xa;&#xa;&#xa;&#xa;&#xa;" X="341.945" Class="uart_byte_tx" Comment="" Color="#d3d3d3" Include="" File="Current/uart_byte_tx.model" Name="uart_byte_tx1">
  <Port Y="0.075" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="1" Inout="input" Datatype="wire" Side="left" X="-0.125" Connect="" Color="#faebd7" Name="Clk"/>
  <Port Y="0.2125" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="1" Inout="input" Datatype="wire" Side="left" X="-0.125" Connect="" Color="#00ffff" Name="Rst_n"/>
  <Port Y="0.35" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="8" Inout="input" Datatype="wire" Side="left" X="-0.125" Connect="data_byte" Color="#7fffd4" Name="data_byte"/>
  <Port Y="0.4875" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="1" Inout="input" Datatype="wire" Side="left" X="-0.125" Connect="byte_send_en" Color="#f0ffff" Name="send_en"/>
  <Port Y="0.625" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="3" Inout="input" Datatype="wire" Side="left" X="-0.125" Connect="" Color="#f5f5dc" Name="Baud_Set"/>
  <Port Y="0.1375" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="1" Inout="output" Datatype="reg" Side="right" X="0.875" Connect="" Color="#ffe4c4" Name="uart_tx"/>
  <Port Y="0.3375" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="1" Inout="output" Datatype="reg" Side="right" X="0.875" Connect="byte_tx_done" Color="#b8860b" Name="Tx_Done"/>
  <Port Y="0.5375" Width="20" Function="" Parent="uart_byte_tx1" Height="20" Datasize="1" Inout="output" Datatype="reg" Side="right" X="0.875" Connect="" Color="#ffebcd" Name="uart_state"/>
 </Module>
 <Port Y="0.125" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="1" Inout="input" Datatype="wire" Side="left" X="-0.0222222" Color="#faebd7" Name="Clk"/>
 <Port Y="0.266667" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="1" Inout="input" Datatype="wire" Side="left" X="-0.0222222" Color="#00ffff" Name="Rst_n"/>
 <Port Y="0.408333" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="DATA_WIDTH - 1 : 0" Inout="input" Datatype="wire" Side="left" X="-0.0222222" Color="#7fffd4" Name="data"/>
 <Port Y="0.55" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="1" Inout="input" Datatype="wire" Side="left" X="-0.0222222" Color="#f0ffff" Name="send_en"/>
 <Port Y="0.691667" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="3" Inout="input" Datatype="wire" Side="left" X="-0.0222222" Color="#f5f5dc" Name="Baud_Set"/>
 <Port Y="0.183333" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="1" Inout="output" Datatype="wire" Side="right" X="0.977778" Color="#ffe4c4" Name="uart_tx"/>
 <Port Y="0.383333" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="1" Inout="output" Datatype="reg" Side="right" X="0.977778" Color="#b8860b" Name="Tx_Done"/>
 <Port Y="0.583333" Width="20" Function="" Parent="uart_data_tx" Height="20" Datasize="1" Inout="output" Datatype="wire" Side="right" X="0.977778" Color="#ffebcd" Name="uart_state"/>
 <Wire Parent="uart_data_tx" From="uart_data_tx>Clk" To="uart_data_tx#uart_byte_tx1>Clk" Datasize="1" Datatype="wire" Name="uart_data_tx_Clk"/>
 <Wire Parent="uart_data_tx" From="uart_data_tx>Rst_n" To="uart_data_tx#uart_byte_tx1>Rst_n" Datasize="1" Datatype="wire" Name="uart_data_tx_Rst_n"/>
 <Wire Parent="uart_data_tx" From="uart_data_tx>Baud_Set" To="uart_data_tx#uart_byte_tx1>Baud_Set" Datasize="3" Datatype="wire" Name="uart_data_tx_Baud_Set"/>
 <Wire Parent="uart_data_tx" From="uart_data_tx#uart_byte_tx1>uart_tx" To="uart_data_tx>uart_tx" Datasize="1" Datatype="wire" Name="uart_byte_tx1_uart_tx"/>
 <Wire Parent="uart_data_tx" From="uart_data_tx#uart_byte_tx1>uart_state" To="uart_data_tx>uart_state" Datasize="1" Datatype="wire" Name="uart_byte_tx1_uart_state"/>
</Module>
