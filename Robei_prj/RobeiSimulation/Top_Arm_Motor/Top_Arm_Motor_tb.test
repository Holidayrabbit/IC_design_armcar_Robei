<!DOCTYPE Robei>
<Module Y="0" Parent="0" Time_Scale="" Comment="" Name="Top_Arm_Motor_tb" Class="module" File="Current/Top_Arm_Motor_tb.test" Include="" X="0" Type="testbench" Color="#d3d3d3" Height="600" Code="&#x9;    wire Tx_Done;    &#xa;&#x9;    wire uart_tx_t;&#xa;&#x9;    assign uart_rx = uart_tx_t;&#xa;&#x9;    &#xa;&#x9;    reg send_en;&#xa;&#x9;    &#xa;&#x9;    pullup PUP(motor_i2c_sdat);&#xa;&#x9;    &#xa;&#x9;&#x9;initial Clk = 1;&#xa;&#x9;&#x9;always #10 Clk = ~Clk;&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;reg [79:0] test_data;&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;initial begin&#xa;&#x9;&#x9;   Rst_n = 0;&#xa;&#x9;&#x9;&#x9;baud_set = 4;&#xa;&#x9;&#x9;   #201;&#xa;&#x9;&#x9;   Rst_n = 1;&#xa;&#x9;&#x9;&#x9;EN=1;&#xa;&#x9;  &#x9;&#x9; #200;&#xa;&#xa;&#x9;&#x9;   test_data = 80'h55_A5_00_00_80_00_00_00_00_F0;&#x9;&#x9;//模拟机械臂的指令&#xa;&#x9;&#x9;   &#xa;&#x9;&#x9;   send_en = 1;&#xa;&#x9;&#x9;   #20;&#xa;&#x9;&#x9;   send_en = 0;&#xa;&#xa;&#xa;&#x9;&#x9;   @(posedge Top_Arm_Motor1.arm_tx_done);&#xa;&#xa;&#xa;&#x9;&#xa;&#x9;&#x9;   #20;&#xa;&#x9;&#x9;   test_data = 80'h55_A5_34_04_35_05_06_07_08_F0;&#x9;&#x9;&#x9;&#x9;//模拟电机的指令&#xa;&#x9;&#x9;   send_en = 1;&#xa;&#x9;&#x9;   #20;&#xa;&#x9;&#x9;   send_en = 0;&#xa;&#xa;&#x9;&#x9;  @(posedge Top_Arm_Motor1.i2c_control_motor_plus3.RW_Done);&#xa;&#x9;&#x9;   #20;&#xa;&#xa;&#xa;&#x9;&#x9;   $finish;&#xa;&#x9;&#x9;end" Width="900">
 <Module Y="152.225" Parent="Top_Arm_Motor_tb" Comment="" Name="Top_Arm_Motor1" Class="Top_Arm_Motor" File="Current/Top_Arm_Motor.model" Include="" X="242.018" Type="model" Color="#d3d3d3" Height="160" Code="&#xa;&#xa;&#xa;" Parameters="" Width="160">
  <Port Y="0.2125" Connect="" Parent="Top_Arm_Motor1" Inout="input" Name="Clk" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#faebd7" Height="20" Width="20" Side="left"/>
  <Port Y="0.35" Connect="" Parent="Top_Arm_Motor1" Inout="input" Name="Rst_n" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#00ffff" Height="20" Width="20" Side="left"/>
  <Port Y="0.4875" Connect="" Parent="Top_Arm_Motor1" Inout="input" Name="baud_set" Function="" X="-0.125" Datatype="wire" Datasize="3" Color="#7fffd4" Height="20" Width="20" Side="left"/>
  <Port Y="0.625" Connect="" Parent="Top_Arm_Motor1" Inout="input" Name="uart_rx" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#f0ffff" Height="20" Width="20" Side="left"/>
  <Port Y="0.1375" Connect="" Parent="Top_Arm_Motor1" Inout="output" Name="arm_uart_tx" Function="" X="0.875" Datatype="wire" Datasize="1" Color="#f5f5dc" Height="20" Width="20" Side="right"/>
  <Port Y="0.3375" Connect="" Parent="Top_Arm_Motor1" Inout="output" Name="motor_i2c_sclk" Function="" X="0.875" Datatype="wire" Datasize="1" Color="#a52a2a" Height="20" Width="20" Side="right"/>
  <Port Y="0.5375" Connect="" Parent="Top_Arm_Motor1" Inout="inout" Name="motor_i2c_sdat" Function="" X="0.875" Datatype="wire" Datasize="1" Color="#deb887" Height="20" Width="20" Side="right"/>
  <Port Y="0.075" Connect="" Parent="Top_Arm_Motor1" Inout="input" Name="Arm_Motor_EN" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#ffebcd" Height="20" Width="20" Side="left"/>
 </Module>
 <Module Y="359.679" Parent="Top_Arm_Motor_tb" Comment="" Name="uart_data_tx2" Class="uart_data_tx" File="Current/uart_data_tx.model" Include="" X="359.679" Type="model" Color="#d3d3d3" Height="160" Code="&#x9;parameter DATA_WIDTH = 80;&#xa;&#x9;parameter MSB_FIRST = 1;&#xa;&#xa;&#x9;reg [DATA_WIDTH-1 : 0]data_r;         //这里得改&#xa;&#xa;&#x9;reg [7:0] data_byte;&#xa;&#x9;reg byte_send_en;&#xa;&#x9;wire byte_tx_done;&#xa;&#xa;&#x9;reg [8:0]cnt;&#xa;&#x9;reg [1:0]state;&#xa;&#x9;&#xa;&#x9;localparam S0 = 0;&#x9;//等待发送请求&#xa;&#x9;localparam S1 = 1;&#x9;//发起单字节数据发送&#xa;&#x9;localparam S2 = 2;&#x9;//等待单字节数据发送完成&#xa;&#x9;localparam S3 = 3;&#x9;//检查所有数据是否发送完成&#xa;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)begin&#xa;&#x9;&#x9;data_byte &lt;= 0;&#xa;&#x9;&#x9;byte_send_en &lt;= 0;&#xa;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;end&#xa;&#x9;else begin&#xa;&#x9;&#x9;case(state)&#xa;&#x9;&#x9;&#x9;S0: &#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(send_en)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;S1:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;byte_send_en &lt;= 1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(MSB_FIRST == 1)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= data_r[DATA_WIDTH-1:DATA_WIDTH - 8];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r &lt;&lt; 8;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= data_r[7:0];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r >> 8;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S2;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;S2:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;byte_send_en &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(byte_tx_done)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S3;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= cnt + 9'd8;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S2;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;S3:&#xa;&#x9;&#x9;&#x9;&#x9;if(cnt >= DATA_WIDTH)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 1;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;default:state &lt;= S0;&#xa;&#x9;&#x9;endcase&#x9;&#xa;&#x9;end&#xa;&#xa;&#xa;" Parameters="" Width="160">
  <Port Y="0.1875" Connect="" Parent="uart_data_tx2" Inout="input" Name="Clk" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#faebd7" Height="20" Width="20" Side="left"/>
  <Port Y="0.3125" Connect="" Parent="uart_data_tx2" Inout="input" Name="Rst_n" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#00ffff" Height="20" Width="20" Side="left"/>
  <Port Y="0.4375" Connect="test_data" Parent="uart_data_tx2" Inout="input" Name="data" Function="" X="-0.125" Datatype="wire" Datasize="DATA_WIDTH - 1 : 0" Color="#7fffd4" Height="20" Width="20" Side="left"/>
  <Port Y="0.5625" Connect="send_en" Parent="uart_data_tx2" Inout="input" Name="send_en" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#f0ffff" Height="20" Width="20" Side="left"/>
  <Port Y="0.6875" Connect="" Parent="uart_data_tx2" Inout="input" Name="Baud_Set" Function="" X="-0.125" Datatype="wire" Datasize="3" Color="#f5f5dc" Height="20" Width="20" Side="left"/>
  <Port Y="0.1375" Connect="uart_tx_t" Parent="uart_data_tx2" Inout="output" Name="uart_tx" Function="" X="0.875" Datatype="wire" Datasize="1" Color="#ffe4c4" Height="20" Width="20" Side="right"/>
  <Port Y="0.3375" Connect="Tx_Done" Parent="uart_data_tx2" Inout="output" Name="Tx_Done" Function="" X="0.875" Datatype="reg" Datasize="1" Color="#b8860b" Height="20" Width="20" Side="right"/>
  <Port Y="0.5375" Connect=" " Parent="uart_data_tx2" Inout="output" Name="uart_state" Function="" X="0.875" Datatype="wire" Datasize="1" Color="#ffebcd" Height="20" Width="20" Side="right"/>
  <Port Y="0.0625" Connect="" Parent="uart_data_tx2" Inout="input" Name="ARM_EN" Function="" X="-0.125" Datatype="wire" Datasize="1" Color="#0000ff" Height="20" Width="20" Side="left"/>
 </Module>
 <Port Y="0.125" Parent="Top_Arm_Motor_tb" Inout="input" Name="Clk" Function="" X="-0.0222222" Datatype="reg" Datasize="1" Color="#faebd7" Height="20" Width="20" Side="left"/>
 <Port Y="0.266667" Parent="Top_Arm_Motor_tb" Inout="input" Name="Rst_n" Function="" X="-0.0222222" Datatype="reg" Datasize="1" Color="#00ffff" Height="20" Width="20" Side="left"/>
 <Port Y="0.408333" Parent="Top_Arm_Motor_tb" Inout="input" Name="baud_set" Function="" X="-0.0222222" Datatype="reg" Datasize="3" Color="#7fffd4" Height="20" Width="20" Side="left"/>
 <Port Y="0.55" Parent="Top_Arm_Motor_tb" Inout="input" Name="uart_rx" Function="" X="-0.0222222" Datatype="wire" Datasize="1" Color="#f0ffff" Height="20" Width="20" Side="left"/>
 <Port Y="0.183333" Parent="Top_Arm_Motor_tb" Inout="output" Name="arm_uart_tx" Function="" X="0.977778" Datatype="wire" Datasize="1" Color="#f5f5dc" Height="20" Width="20" Side="right"/>
 <Port Y="0.383333" Parent="Top_Arm_Motor_tb" Inout="output" Name="motor_i2c_sclk" Function="" X="0.977778" Datatype="wire" Datasize="1" Color="#a52a2a" Height="20" Width="20" Side="right"/>
 <Port Y="0.583333" Parent="Top_Arm_Motor_tb" Inout="inout" Name="motor_i2c_sdat" Function="" X="0.977778" Datatype="wire" Datasize="1" Color="#deb887" Height="20" Width="20" Side="right"/>
 <Port Y="0.691667" Parent="Top_Arm_Motor_tb" Inout="input" Name="EN" Function="" X="-0.0222222" Datatype="reg" Datasize="1" Color="#ffebcd" Height="20" Width="20" Side="left"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_Clk" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb#Top_Arm_Motor1>Clk" From="Top_Arm_Motor_tb>Clk"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_Rst_n" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb#Top_Arm_Motor1>Rst_n" From="Top_Arm_Motor_tb>Rst_n"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_baud_set" Datatype="wire" Datasize="3" To="Top_Arm_Motor_tb#Top_Arm_Motor1>baud_set" From="Top_Arm_Motor_tb>baud_set"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_uart_rx" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb#Top_Arm_Motor1>uart_rx" From="Top_Arm_Motor_tb>uart_rx"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor1_arm_uart_tx" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb>arm_uart_tx" From="Top_Arm_Motor_tb#Top_Arm_Motor1>arm_uart_tx"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor1_motor_i2c_sclk" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb>motor_i2c_sclk" From="Top_Arm_Motor_tb#Top_Arm_Motor1>motor_i2c_sclk"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor1_motor_i2c_sdat" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb>motor_i2c_sdat" From="Top_Arm_Motor_tb#Top_Arm_Motor1>motor_i2c_sdat"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_Clk" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb#uart_data_tx2>Clk" From="Top_Arm_Motor_tb>Clk"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_Rst_n" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb#uart_data_tx2>Rst_n" From="Top_Arm_Motor_tb>Rst_n"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_baud_set" Datatype="wire" Datasize="3" To="Top_Arm_Motor_tb#uart_data_tx2>Baud_Set" From="Top_Arm_Motor_tb>baud_set"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_EN" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb#Top_Arm_Motor1>Arm_Motor_EN" From="Top_Arm_Motor_tb>EN"/>
 <Wire Parent="Top_Arm_Motor_tb" Name="Top_Arm_Motor_tb_EN" Datatype="wire" Datasize="1" To="Top_Arm_Motor_tb#uart_data_tx2>ARM_EN" From="Top_Arm_Motor_tb>EN"/>
</Module>
