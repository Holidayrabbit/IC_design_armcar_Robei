<!DOCTYPE Robei>
<Module X="0" Color="#d3d3d3" Y="0" Name="uart_data_tx_tb" Class="module" Width="900" Type="testbench" File="Current/uart_data_tx_tb.test" Code="&#x9;parameter DATA_WIDTH = 56;&#xa;&#x9;parameter MSB_FIRST = 1;&#xa;/*&#xa;&#x9;initial Clk = 1;&#xa;&#x9;always #1 Clk = !Clk;&#xa;&#x9;&#xa;&#x9;initial begin&#xa;&#x9;&#x9;Rst_n = 0;&#xa;&#x9;&#x9;data = 0;&#xa;&#x9;&#x9;send_en = 0;&#xa;&#x9;&#x9;#201;&#xa;&#x9;&#x9;Rst_n = 1;&#xa;&#x9;&#x9;#2000;&#xa;&#x9;&#x9;data = 32'h12344567;&#xa;&#x9;&#x9;send_en = 1;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;send_en = 0;&#xa;&#xa;&#x9;&#x9;#200000;&#xa;&#x9;&#x9;$finish;&#x9;&#x9;&#xa;&#x9;end&#xa;*/&#xa;&#xa;&#x9;initial Clk = 1;&#xa;&#x9;always #10 Clk = !Clk;&#xa;&#x9;&#xa;&#x9;initial begin&#xa;&#x9;&#x9;Rst_n = 0;&#xa;&#x9;&#x9;data = 0;&#xa;&#x9;&#x9;send_en = 0;&#xa;&#x9;&#x9;#201;&#xa;&#x9;&#x9;Rst_n = 1;&#xa;&#x9;&#x9;#200;&#xa;&#x9;&#x9;data = 56'h01234567012345;&#xa;&#x9;&#x9;send_en = 1;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;send_en = 0;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;@(posedge Tx_Done);&#xa;&#x9;&#x9;#1;&#xa;&#x9;&#x9;data = 56'h12345678123456;&#xa;&#x9;&#x9;send_en = 1;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;send_en = 0;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;@(posedge Tx_Done);&#xa;&#x9;&#x9;#1;&#x9;&#xa;&#x9;&#x9;#100000;&#xa;&#x9;&#x9;data = 56'h23456789234567;&#xa;&#x9;&#x9;#200;&#xa;&#x9;&#x9;send_en = 1;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;send_en = 0;&#xa;&#x9;&#x9;#20;&#xa;&#x9;&#x9;@(posedge Tx_Done);&#xa;&#x9;&#x9;#1;&#xa;&#x9;&#x9;#2000;&#xa;&#x9;&#x9;$finish;&#x9;&#x9;&#xa;&#x9;end" Comment="" Time_Scale="" Height="600" Parent="0" Include="">
 <Module X="368.966" Color="#d3d3d3" Y="229.31" Name="uart_data_tx1" Class="uart_data_tx" Width="160" Type="model" File="Current/uart_data_tx.model" Code="&#x9;parameter DATA_WIDTH = 8;&#xa;&#x9;parameter MSB_FIRST = 1;&#xa;&#xa;&#x9;reg [DATA_WIDTH - 1 : 0]data_r;&#xa;&#xa;&#x9;reg [7:0] data_byte;&#xa;&#x9;reg byte_send_en;&#xa;&#x9;wire byte_tx_done;&#xa;&#xa;&#x9;reg [8:0]cnt;&#xa;&#x9;reg [1:0]state;&#xa;&#x9;&#xa;&#x9;localparam S0 = 0;&#x9;//等待发送请求&#xa;&#x9;localparam S1 = 1;&#x9;//发起单字节数据发送&#xa;&#x9;localparam S2 = 2;&#x9;//等待单字节数据发送完成&#xa;&#x9;localparam S3 = 3;&#x9;//检查所有数据是否发送完成&#xa;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)begin&#xa;&#x9;&#x9;data_byte &lt;= 0;&#xa;&#x9;&#x9;byte_send_en &lt;= 0;&#xa;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;end&#xa;&#x9;else begin&#xa;&#x9;&#x9;case(state)&#xa;&#x9;&#x9;&#x9;S0: &#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(send_en)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;S1:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;byte_send_en &lt;= 1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(MSB_FIRST == 1)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= data_r[DATA_WIDTH-1:DATA_WIDTH - 8];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r &lt;&lt; 8;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_byte &lt;= data_r[7:0];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;data_r &lt;= data_r >> 8;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S2;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;S2:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;byte_send_en &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(byte_tx_done)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S3;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= cnt + 9'd8;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S2;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;S3:&#xa;&#x9;&#x9;&#x9;&#x9;if(cnt >= DATA_WIDTH)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 1;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;else begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Tx_Done &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;default:state &lt;= S0;&#xa;&#x9;&#x9;endcase&#x9;&#xa;&#x9;end&#xa;&#xa;&#xa;" Comment="" Parameters="" Height="160" Parent="uart_data_tx_tb" Include="">
  <Port Datasize="1" Connect="" Side="left" Inout="input" X="-0.125" Datatype="wire" Color="#faebd7" Y="0.075" Name="Clk" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
  <Port Datasize="1" Connect="" Side="left" Inout="input" X="-0.125" Datatype="wire" Color="#00ffff" Y="0.2125" Name="Rst_n" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
  <Port Datasize="DATA_WIDTH - 1 : 0" Connect="" Side="left" Inout="input" X="-0.125" Datatype="wire" Color="#7fffd4" Y="0.35" Name="data" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
  <Port Datasize="1" Connect="" Side="left" Inout="input" X="-0.125" Datatype="wire" Color="#f0ffff" Y="0.4875" Name="send_en" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
  <Port Datasize="3" Connect="3'd4" Side="left" Inout="input" X="-0.125" Datatype="wire" Color="#f5f5dc" Y="0.625" Name="Baud_Set" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
  <Port Datasize="1" Connect="" Side="right" Inout="output" X="0.875" Datatype="wire" Color="#ffe4c4" Y="0.1375" Name="uart_tx" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
  <Port Datasize="1" Connect="" Side="right" Inout="output" X="0.875" Datatype="reg" Color="#b8860b" Y="0.3375" Name="Tx_Done" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
  <Port Datasize="1" Connect="" Side="right" Inout="output" X="0.875" Datatype="wire" Color="#ffebcd" Y="0.5375" Name="uart_state" Width="20" Function="" Height="20" Parent="uart_data_tx1"/>
 </Module>
 <Port Datasize="1" Side="left" Inout="input" X="-0.0222222" Datatype="reg" Color="#faebd7" Y="0.125" Name="Clk" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Port Datasize="1" Side="left" Inout="input" X="-0.0222222" Datatype="reg" Color="#00ffff" Y="0.266667" Name="Rst_n" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Port Datasize="DATA_WIDTH - 1 : 0" Side="left" Inout="input" X="-0.0222222" Datatype="reg" Color="#7fffd4" Y="0.408333" Name="data" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Port Datasize="1" Side="left" Inout="input" X="-0.0222222" Datatype="reg" Color="#f0ffff" Y="0.55" Name="send_en" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Port Datasize="3" Side="left" Inout="input" X="-0.0222222" Datatype="reg" Color="#f5f5dc" Y="0.691667" Name="Baud_Set" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Port Datasize="1" Side="right" Inout="output" X="0.977778" Datatype="wire" Color="#ffe4c4" Y="0.183333" Name="uart_tx" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Port Datasize="1" Side="right" Inout="output" X="0.977778" Datatype="wire" Color="#b8860b" Y="0.383333" Name="Tx_Done" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Port Datasize="1" Side="right" Inout="output" X="0.977778" Datatype="wire" Color="#ffebcd" Y="0.583333" Name="uart_state" Width="20" Function="" Height="20" Parent="uart_data_tx_tb"/>
 <Wire From="uart_data_tx_tb>Clk" Datasize="1" Datatype="wire" Name="uart_data_tx_tb_Clk" To="uart_data_tx_tb#uart_data_tx1>Clk" Parent="uart_data_tx_tb"/>
 <Wire From="uart_data_tx_tb>Rst_n" Datasize="1" Datatype="wire" Name="uart_data_tx_tb_Rst_n" To="uart_data_tx_tb#uart_data_tx1>Rst_n" Parent="uart_data_tx_tb"/>
 <Wire From="uart_data_tx_tb>data" Datasize="DATA_WIDTH - 1 : 0" Datatype="wire" Name="uart_data_tx_tb_data" To="uart_data_tx_tb#uart_data_tx1>data" Parent="uart_data_tx_tb"/>
 <Wire From="uart_data_tx_tb>send_en" Datasize="1" Datatype="wire" Name="uart_data_tx_tb_send_en" To="uart_data_tx_tb#uart_data_tx1>send_en" Parent="uart_data_tx_tb"/>
 <Wire From="uart_data_tx_tb#uart_data_tx1>uart_tx" Datasize="1" Datatype="wire" Name="uart_data_tx1_uart_tx" To="uart_data_tx_tb>uart_tx" Parent="uart_data_tx_tb"/>
 <Wire From="uart_data_tx_tb#uart_data_tx1>Tx_Done" Datasize="1" Datatype="wire" Name="uart_data_tx1_Tx_Done" To="uart_data_tx_tb>Tx_Done" Parent="uart_data_tx_tb"/>
 <Wire From="uart_data_tx_tb#uart_data_tx1>uart_state" Datasize="1" Datatype="wire" Name="uart_data_tx1_uart_state" To="uart_data_tx_tb>uart_state" Parent="uart_data_tx_tb"/>
</Module>
