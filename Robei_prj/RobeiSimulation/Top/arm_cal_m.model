<!DOCTYPE Robei>
<Module X="0" Class="module" Type="module" Width="900" Parent="0" Height="600" Y="0" Code="&#x9;&#x9;parameter DATA_WIDTH = 80;&#xa;&#x9;&#x9;parameter fill_data = 8'h55;//55&#xa;&#x9;&#x9;parameter delta_angle_low = 8'h1a;//每次变化角度5°对1来说太大了1应该就&#xa;&#x9;&#x9;parameter delta_angle_heigh = 8'h00;&#xa;&#x9;&#x9;parameter time_low = 8'hf4;//f4 &#xa;&#x9;&#x9;parameter time_heigh =8'h00; //01&#xa;&#x9;&#x9;reg [DATA_WIDTH-1:0] reg_out_data;&#xa;&#x9;&#x9;reg [7:0] angle_low [5:0];&#xa;&#x9;&#x9;reg [7:0] angle_heigh [5:0];&#xa;&#x9;&#x9;reg [7:0] reg_cal;////////////////&#xa;&#x9;&#x9;reg [7:0] med_angle;&#xa;&#x9;&#x9;reg [7:0] in_low;&#xa;&#x9;&#x9;reg [7:0] in_heigh;&#xa;&#x9;&#x9;reg [7:0] reg_id;&#xa;&#x9;&#x9;reg [7:0] send_id;&#xa;&#x9;&#x9;reg run_valid;&#xa;&#x9;&#x9;integer i;&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;localparam S0 = 0;&#x9;//等待发送请求&#xa;&#x9;&#x9;localparam S1 = 1;&#x9;//计算数据发送&#xa;&#x9;&#x9;localparam S2 = 2;&#x9;//等待单字节数据发送完成&#xa;&#x9;&#x9;localparam S3 = 3;&#x9;//检查所有数据是否发送完成&#xa;&#x9;&#x9;reg [2:0] Rst_length;&#xa;&#x9;&#x9;reg [1:0] state_cal;&#xa;&#x9;&#x9;always @(posedge Clk or negedge Rst_n)&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;if (!Rst_n)&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;angle_low[0] &lt;= 8'hE9;&#xa;&#x9;&#x9;&#x9;angle_heigh[0] &lt;= 8'h00;&#xa;&#x9;&#x9;&#x9;angle_low[1] &lt;= 8'hFA;&#xa;&#x9;&#x9;&#x9;angle_heigh[1] &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;angle_low[2] &lt;= 8'h92;&#xa;&#x9;&#x9;&#x9;angle_heigh[2] &lt;= 8'h00;&#xa;&#x9;&#x9;&#x9;angle_low[3] &lt;= 8'h6a;&#xa;&#x9;&#x9;&#x9;angle_heigh[3] &lt;= 8'h03;&#xa;&#x9;&#x9;&#x9;angle_low[4] &lt;= 8'h08;&#xa;&#x9;&#x9;&#x9;angle_heigh[4] &lt;= 8'h02;&#xa;&#x9;&#x9;&#x9;angle_low[5] &lt;= 8'hF4;&#xa;&#x9;&#x9;&#x9;angle_heigh[5] &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;med_angle &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;in_low &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;in_heigh &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;reg_id &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;send_id &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;state_cal &lt;= S0;&#xa;&#x9;&#x9;&#x9;reg_cal &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;Rst_length &lt;= 3'h2;&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;//计算数据&#xa;&#x9;&#x9;&#x9;case(state_cal)&#xa;&#x9;&#x9;&#x9;S0:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;if(input_id != 8'h0)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;                Rst_length &lt;= 3'h2;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state_cal &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;reg_id &lt;= input_id;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;S1:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;case(reg_id)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h1:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[0];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[0]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (input_cmd)  //加法 ??????????阻塞or非阻塞,顺时针&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[0],angle_heigh[0]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[0],angle_heigh[0]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[0];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[0]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h2:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[1];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[1]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (input_cmd) &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[1],angle_heigh[1]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[1],angle_heigh[1]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[1];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[1]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h3:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[2];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[2]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (input_cmd)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[2],angle_heigh[2]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[2],angle_heigh[2]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[2];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[2];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h4:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[3];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[3]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (input_cmd) &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[3],angle_heigh[3]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[3],angle_heigh[3]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[3];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[3];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h5:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[4];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[4]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (input_cmd)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[4],angle_heigh[4]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[4],angle_heigh[4]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[4];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[4];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h6:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[5];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[5]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if (input_cmd)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[5],angle_heigh[5]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[5],angle_heigh[5]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[5];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[5];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h7://一步复位&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;    begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        send_id &lt;= Rst_length;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        Rst_length &lt;= Rst_length + 3'h1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        case (Rst_length)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h6:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hf4;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[5] &lt;= 8'hf4;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[5] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h5:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hee;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[4] &lt;= 8'hee;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[4] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h4:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hfe;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[3] &lt;= 8'hfe;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[3] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h3:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'he4;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[2] &lt;= 8'he4;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[2] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h2:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hfa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[1] &lt;= 8'hfa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[1] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h1:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                reg_cal &lt;= 8'd0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        default:&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        in_low &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        in_heigh &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        send_id &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        endcase&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h8://一步放下左侧&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;    begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        send_id &lt;= Rst_length;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        Rst_length &lt;= Rst_length + 3'h1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        case (Rst_length)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h6:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'h60;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h03;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[5] &lt;= 8'h60;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[5] &lt;=8'h03;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h5:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hea;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[4] &lt;= 8'hea;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[4] &lt;=8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h4:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'h66;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h02;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[3] &lt;= 8'h66;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[3] &lt;=8'h02;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h3:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hac;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[2] &lt;= 8'hac;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[2] &lt;=8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h2:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hfa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[1] &lt;= 8'hfa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[1] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h1:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                reg_cal &lt;= 8'd0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        default:&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        in_low &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        in_heigh &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        send_id &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        endcase&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;8'h9://一步放下右侧&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;    begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        send_id &lt;= Rst_length;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        Rst_length &lt;= Rst_length + 3'h1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        case (Rst_length)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h6:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'h6e;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[5] &lt;= 8'h6e;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[5] &lt;=8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h5:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'h38;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[4] &lt;= 8'h38;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[4] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h4:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'h66;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h02;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[3] &lt;= 8'h66;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[3] &lt;=8'h02;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h3:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hac;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[2] &lt;= 8'hac;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[2] &lt;=8'h00;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h2:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                in_low &lt;= 8'hfa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            in_heigh &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_low[1] &lt;= 8'hfa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            angle_heigh[1] &lt;=8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;            3'h1:&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;                reg_cal &lt;= 8'd0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;            end &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        default:&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        in_low &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        in_heigh &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        send_id &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;        end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;        endcase&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;default:&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;endcase&#xa;&#x9;&#x9;&#x9;&#x9;state_cal &lt;= S2 ;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;S2:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;data_out[79:72] &lt;= fill_data; // 0101 0101&#xa;&#x9;&#x9;&#x9;&#x9;data_out[71:64] &lt;= fill_data;// 0101 0101&#xa;&#x9;&#x9;&#x9;&#x9;data_out[63:56] &lt;= send_id;//reg_id&#xa;&#x9;&#x9;&#x9;&#x9;data_out[55:48] &lt;= 8'h07;//8'h7&#xa;&#x9;&#x9;&#x9;&#x9;data_out[47:40] &lt;= 8'h01;//8'h1&#xa;&#x9;&#x9;&#x9;&#x9;data_out[39:32] &lt;= in_low;//in_low&#xa;&#x9;&#x9;&#x9;&#x9;data_out[31:24] &lt;= in_heigh;//in_heigh&#xa;&#x9;&#x9;&#x9;&#x9;data_out[23:16] &lt;= time_low;//time_low&#xa;&#x9;&#x9;&#x9;&#x9;data_out[15:8] &lt;= time_heigh;//time_heigh&#xa;&#x9;&#x9;&#x9;&#x9;data_out[7:0] = (8'hff-(send_id+8'b00000111+8'h1+in_heigh+in_low+time_heigh+time_low));//reg_cal&#xa;&#x9;&#x9;&#x9;&#x9;state_cal &lt;= S3;&#xa;&#x9;&#x9;&#x9;&#x9;send_en_out &lt;= 1'b1;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;S3:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;send_en_out &lt;= 1'b0;&#xa;&#x9;            if (Tx_Done_flag != 1)&#xa;&#x9;&#x9;&#x9;&#x9;    state_cal &lt;= S3;&#xa;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;    begin&#xa;&#x9;&#x9;&#x9;&#x9;    state_cal &lt;= S0;&#xa;&#x9;&#x9;&#x9;&#x9;    if (reg_id >= 8'h7 &amp;&amp; Rst_length != 3'h7)&#xa;&#x9;&#x9;&#x9;&#x9;             state_cal &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;endcase&#xa;&#x9;&#x9;&#x9;end &#xa;&#x9;&#x9;end&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;reg return_valid;&#xa;&#x9;&#x9;//返回接受有效信号&#xa;&#x9;&#x9;always @(posedge Clk or negedge Rst_n)&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;if(!Rst_n)&#xa;&#x9;&#x9;&#x9;return_valid &lt;= 1'b0;&#xa;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;if(input_id != 8'h0)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;return_valid &lt;= 1'b1;&#xa;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;return_valid &lt;= 1'b0;&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;end&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;task add_model;&#xa;&#x9;&#x9;&#x9;input [7:0] angle_low_tr;&#xa;&#x9;&#x9;&#x9;input [7:0] angle_heigh_tr;&#xa;&#x9;&#x9;&#x9;output [7:0] a_low;&#xa;&#x9;&#x9;&#x9;output [7:0] a_heigh;&#xa;&#x9;&#x9;&#x9;begin//加法 ??????????阻塞or非阻塞&#xa;&#x9;&#x9;&#x9;med_angle = 8'h0;&#xa;&#x9;&#x9;&#x9;a_low = delta_angle_low + angle_low_tr;&#xa;&#x9;&#x9;&#x9;med_angle = angle_heigh_tr;&#xa;&#x9;&#x9;&#x9;if (a_low &lt; angle_low_tr)&#xa;&#x9;&#x9;&#x9;&#x9;med_angle = angle_heigh_tr + 8'h01;&#xa;&#x9;&#x9;&#x9;a_heigh = med_angle + delta_angle_heigh;&#xa;&#x9;&#x9;&#x9;med_angle = 8'h0;&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;endtask&#xa;&#x9;&#x9;&#xa;&#x9;&#x9;task sub_model;&#xa;&#x9;&#x9;&#x9;input [7:0] angle_low_tr;&#xa;&#x9;&#x9;&#x9;input [7:0] angle_heigh_tr;&#xa;&#x9;&#x9;&#x9;output [7:0] a_low;&#xa;&#x9;&#x9;&#x9;output [7:0] a_heigh;&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;med_angle = 8'h0;&#xa;&#x9;&#x9;&#x9;if (angle_heigh_tr &lt; delta_angle_heigh)&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;  a_low = 8'h0; &#xa;&#x9;&#x9;&#x9;  a_heigh = 8'h0;&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;  if (delta_angle_low &lt;= angle_low_tr)&#xa;&#x9;&#x9;&#x9;  begin&#xa;&#x9;&#x9;&#x9;&#x9; a_low = angle_low_tr - delta_angle_low;&#xa;&#x9;&#x9;&#x9;&#x9; a_heigh = angle_heigh_tr - delta_angle_heigh;&#xa;&#x9;&#x9;      end&#xa;&#x9;&#x9;&#x9;  else &#xa;&#x9;&#x9;&#x9;  begin&#xa;&#x9;&#x9;&#x9;&#x9; if (angle_heigh_tr == delta_angle_heigh)&#xa;&#x9;&#x9;&#x9;&#x9; begin&#xa;&#x9;&#x9;&#x9;&#x9;     a_low = 8'h0; &#xa;&#x9;&#x9;&#x9;&#x9;     a_heigh = 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9; end&#xa;&#x9;&#x9;&#x9;&#x9; else&#xa;&#x9;&#x9;&#x9;&#x9; begin&#xa;&#x9;&#x9;&#x9;&#x9;     a_heigh = angle_heigh_tr - delta_angle_heigh - 8'h1;&#xa;&#x9;&#x9;&#x9;&#x9;     a_low = ~(delta_angle_low-angle_low_tr)+8'h1;&#xa;&#x9;&#x9;&#x9;&#x9; end&#xa;&#x9;&#x9;&#x9;  end&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#xa;&#x9;   &#x9;&#x9;end&#xa;&#x9;&#x9;endtask " Name="arm_cal_m" Comment="" File="Current/arm_cal_m.model" Color="#d3d3d3" Include="" Parameters="">
 <Port Datatype="wire" Datasize="1" X="-0.0222222" Inout="input" Width="20" Function="" Parent="arm_cal_m" Height="20" Y="0.125" Name="Clk" Color="#faebd7" Side="left"/>
 <Port Datatype="wire" Datasize="1" X="-0.0222222" Inout="input" Width="20" Function="" Parent="arm_cal_m" Height="20" Y="0.266667" Name="Rst_n" Color="#00ffff" Side="left"/>
 <Port Datatype="wire" Datasize="1" X="-0.0222222" Inout="input" Width="20" Function="" Parent="arm_cal_m" Height="20" Y="0.55" Name="input_cmd" Color="#7fffd4" Side="left"/>
 <Port Datatype="reg" Datasize="80" X="0.977778" Inout="output" Width="20" Function="" Parent="arm_cal_m" Height="20" Y="0.233333" Name="data_out" Color="#a52a2a" Side="right"/>
 <Port Datatype="reg" Datasize="1" X="0.977778" Inout="output" Width="20" Function="" Parent="arm_cal_m" Height="20" Y="0.483333" Name="send_en_out" Color="#f5f5dc" Side="right"/>
 <Port Datatype="wire" Datasize="8" X="-0.0222222" Inout="input" Width="20" Function="" Parent="arm_cal_m" Height="20" Y="0.408333" Name="input_id" Color="#ffe4c4" Side="left"/>
 <Port Datatype="wire" Datasize="1" X="-0.0222222" Inout="input" Width="20" Function="" Parent="arm_cal_m" Height="20" Y="0.691667" Name="Tx_Done_flag" Color="#b8860b" Side="left"/>
</Module>
