<!DOCTYPE Robei>
<Module Name="LM75A_drive" Type="module" Include="" File="Current/LM75A_drive.model" X="0" Class="module" Width="900" Y="0" Code="&#xa;&#xa;&#xa;" Parent="0" Height="600" Parameters="" Color="#d3d3d3" Comment="">
 <Module Name="Read_clock_of_LM75A1" Type="model" Include="" File="Current/Read_clock_of_LM75A.model" X="190.608" Class="Read_clock_of_LM75A" Width="160" Y="89.2568" Code="&#x9;//parameter DELAY=5_000_000;&#xa;&#x9;parameter DELAY=50; //for test&#xa;&#x9;    &#xa;&#x9;    reg [23:0] cnt_delay;&#xa;&#x9;    reg rst_flag;&#xa;&#x9;    &#xa;&#x9;    always@ (posedge Clk or negedge Rst_n)begin&#xa;&#x9;        if(!Rst_n)begin&#xa;&#x9;            cnt_delay&lt;=24'b0;&#xa;&#x9;            Finish&lt;=0;&#xa;&#x9;        end&#xa;&#x9;        else if(LM75A_EN)begin&#xa;&#x9;            if(cnt_delay==DELAY)begin&#xa;&#x9;               Finish&lt;=1'b1; &#xa;&#x9;               cnt_delay&lt;=24'b0;&#xa;&#x9;            end&#xa;&#x9;            else begin&#xa;&#x9;                Finish&lt;=1'b0;&#xa;&#x9;                cnt_delay&lt;=cnt_delay+1;&#xa;&#x9;            end                &#xa;&#x9;         end&#xa;&#x9;         else begin&#xa;&#x9;             Finish&lt;=1'b0;&#xa;&#x9;             cnt_delay&lt;=24'b0;&#xa;&#x9;         end&#xa;&#x9;           &#xa;&#x9;    end&#xa;&#x9;" Parent="LM75A_drive" Height="160" Parameters="" Color="#d3d3d3" Comment="">
  <Port Datasize="1" Side="left" Name="Clk" X="-0.125" Inout="input" Datatype="wire" Width="20" Y="0.1375" Parent="Read_clock_of_LM75A1" Height="20" Color="#ff0000" Connect="" Function=""/>
  <Port Datasize="1" Side="left" Name="Rst_n" X="-0.125" Inout="input" Datatype="wire" Width="20" Y="0.3375" Parent="Read_clock_of_LM75A1" Height="20" Color="#ffff00" Connect="" Function=""/>
  <Port Datasize="1" Side="left" Name="LM75A_EN" X="-0.125" Inout="input" Datatype="wire" Width="20" Y="0.5375" Parent="Read_clock_of_LM75A1" Height="20" Color="#0000ff" Connect="" Function=""/>
  <Port Datasize="1" Side="right" Name="Finish" X="0.875" Inout="output" Datatype="reg" Width="20" Y="0.26875" Parent="Read_clock_of_LM75A1" Height="20" Color="#800080" Connect="" Function=""/>
 </Module>
 <Module Name="LM75A_i2c_control2" Type="model" Include="0" File="Current/LM75A_i2c_control.model" X="499.73" Class="LM75A_i2c_control" Width="160" Y="329.459" Code="&#x9;&#xa;&#x9;localparam  lm75a_address=7'b1001_000; &#xa;&#xa;&#xa;&#xa;&#x9;reg [5:0]Cmd;&#xa;&#x9;reg [7:0]Tx_DATA;&#xa;&#x9;wire Trans_Done;&#xa;&#x9;wire ack_o;&#xa;&#x9;reg Go;&#xa;&#xa;&#x9;//buffer for input data or out put data&#xa;&#x9; reg [7:0] temp_out_reg;&#xa;&#x9; reg [7:0] temp_in_Mreg;&#xa;&#x9; reg [7:0] temp_in_Lreg;&#xa;&#x9;&#xa;&#x9;&#xa;&#x9;wire [15:0] reg_addr;&#xa;&#x9;&#xa;&#x9;assign reg_addr = addr_mode?addr:{addr[7:0],addr[15:8]};&#x9;&#x9;&#x9;//仿真记得拉高&#xa;&#x9;&#xa;&#x9;wire [7:0]Rx_DATA;&#xa;&#x9;reg [10:0] data_LM75A; //temperature data&#xa;&#x9;&#xa;&#x9;localparam &#xa;&#x9;&#x9;WR   = 6'b000001,   //写请求&#xa;&#x9;&#x9;STA  = 6'b000010,   //起始位请求&#xa;&#x9;&#x9;RD   = 6'b000100,   //读请求&#xa;&#x9;&#x9;STO  = 6'b001000,   //停止位请求&#xa;&#x9;&#x9;ACK  = 6'b010000,   //应答位请求&#xa;&#x9;&#x9;NACK = 6'b100000;   //无应答请求&#xa;&#xa;&#xa;&#x9;&#xa;&#x9;reg [6:0]state;&#xa;&#x9;reg [7:0]cnt;&#xa;&#x9;&#xa;&#x9;localparam&#xa;&#x9;&#x9;IDLE         = 7'b0000001,   //空闲状态&#xa;&#x9;&#x9;WR_REG       = 7'b0000010,   //写寄存器状态&#xa;&#x9;&#x9;WAIT_WR_DONE = 7'b0000100,   //等待写寄存器完成状态&#xa;&#x9;&#x9;WR_REG_DONE  = 7'b0001000,   //写寄存器完成状态&#xa;&#x9;&#x9;RD_REG       = 7'b0010000,   //读寄存器状态&#xa;&#x9;&#x9;WAIT_RD_DONE = 7'b0100000,   //等待读寄存器完成状态&#xa;&#x9;&#x9;RD_REG_DONE  = 7'b1000000;   //读寄存器完成状态&#xa;&#x9;&#xa;&#x9;always@(posedge Clk or negedge Rst_n)&#xa;&#x9;if(!Rst_n)begin&#xa;&#x9;&#x9;Cmd &lt;= 6'd0;&#xa;&#x9;&#x9;Tx_DATA &lt;= 8'd0;&#xa;&#x9;&#x9;Go &lt;= 1'b0;&#xa;&#x9;&#x9;rddata &lt;= 0;&#xa;&#x9;&#x9;state &lt;= IDLE;&#xa;&#x9;&#x9;ack &lt;= 0;&#xa;&#x9;end&#xa;&#x9;else begin&#xa;&#x9;&#x9;case(state)&#xa;&#x9;&#x9;&#x9;IDLE:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;ack &lt;= 0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;RW_Done &lt;= 1'b0;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(rdreg_req)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= RD_REG;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= IDLE;&#xa;&#x9;&#x9;&#x9;&#x9;end&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;RD_REG:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= WAIT_RD_DONE;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;case(cnt)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;0:write_byte(WR | STA, {lm75a_address,1'b1});&#x9;&#x9;&#x9;//发送lm75a的地址和读信号（1）&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1:read_byte(RD | ACK);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;2:read_byte(RD | NACK | STO);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;default:;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;endcase&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;WAIT_RD_DONE:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;Go &lt;= 1'b0; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(Trans_Done)begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;if(cnt &lt;= 1)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;ack &lt;= ack | ack_o;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;case(cnt)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;0: begin cnt &lt;= 1; state &lt;= RD_REG;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;1: &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp_in_Mreg &lt;= Rx_DATA;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cnt &lt;= 2;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= RD_REG;&#xa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;2: begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp_in_Lreg &lt;= Rx_DATA;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= RD_REG_DONE;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;default:state &lt;= IDLE;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;endcase&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;RD_REG_DONE:&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;RW_Done &lt;= 1'b1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if(!temp_in_Mreg[7]) //the value of the temperature data is judged by the highest bit.&#xa;&#x9;                       data_LM75A&lt;={word_in_Mreg,word_in_Lreg[7:5]};&#xa;&#x9;                else&#xa;&#x9;                       data_LM75A&lt;=~{word_in_Mreg,word_in_Lreg[7:5]}+1;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;/*&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;temp_decade&lt;=(data_LM75A>>3)/10; //data_LM75A*125/10000, if(data_LM75A&lt;100)&#x9;&#x9;&#x9;//温度的十位&#xa;&#x9;                    temp_unit&lt;=(data_LM75A>>3)%10;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;//温度的个位&#xa;&#x9;                    temp_decimal=(data_LM75A*125/100)%10;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;//温度的小数位&#xa;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;*/&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;rddata &lt;= data_LM75A;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;state &lt;= IDLE;&#x9;&#x9;&#x9;&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;default:state &lt;= IDLE;&#xa;&#x9;&#x9;endcase&#xa;&#x9;end&#xa;&#x9;&#xa;&#x9;task read_byte;&#xa;&#x9;&#x9;input [5:0]Ctrl_Cmd;&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;Cmd &lt;= Ctrl_Cmd;&#xa;&#x9;&#x9;&#x9;Go &lt;= 1'b1; &#xa;&#x9;&#x9;end&#xa;&#x9;endtask&#xa;&#x9;&#xa;&#x9;task write_byte;&#xa;&#x9;&#x9;input [5:0]Ctrl_Cmd;&#xa;&#x9;&#x9;input [7:0]Wr_Byte_Data;&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;Cmd &lt;= Ctrl_Cmd;&#xa;&#x9;&#x9;&#x9;Tx_DATA &lt;= Wr_Byte_Data;&#xa;&#x9;&#x9;&#x9;Go &lt;= 1'b1; &#xa;&#x9;&#x9;end&#xa;&#x9;endtask&#xa;" Parent="LM75A_drive" Height="160" Parameters="" Color="#d3d3d3" Comment="">
  <Port Datasize="1" Side="left" Name="Clk" X="-0.125" Inout="input" Datatype="wire" Width="20" Y="0.1375" Parent="LM75A_i2c_control2" Height="20" Color="#faebd7" Connect="" Function=""/>
  <Port Datasize="1" Side="left" Name="Rst_n" X="-0.125" Inout="input" Datatype="wire" Width="20" Y="0.3375" Parent="LM75A_i2c_control2" Height="20" Color="#00ffff" Connect="" Function=""/>
  <Port Datasize="1" Side="left" Name="rdreg_req" X="-0.125" Inout="input" Datatype="wire" Width="20" Y="0.5375" Parent="LM75A_i2c_control2" Height="20" Color="#f0ffff" Connect="" Function=""/>
  <Port Datasize="8" Side="right" Name="rddata" X="0.875" Inout="output" Datatype="reg" Width="20" Y="0.075" Parent="LM75A_i2c_control2" Height="20" Color="#0000ff" Connect="" Function=""/>
  <Port Datasize="1" Side="right" Name="RW_Done" X="0.875" Inout="output" Datatype="reg" Width="20" Y="0.2125" Parent="LM75A_i2c_control2" Height="20" Color="#8a2be2" Connect="" Function=""/>
  <Port Datasize="1" Side="right" Name="ack" X="0.875" Inout="output" Datatype="reg" Width="20" Y="0.35" Parent="LM75A_i2c_control2" Height="20" Color="#a52a2a" Connect=" " Function=""/>
  <Port Datasize="1" Side="right" Name="i2c_sclk" X="0.875" Inout="output" Datatype="wire" Width="20" Y="0.4875" Parent="LM75A_i2c_control2" Height="20" Color="#deb887" Connect="" Function=""/>
  <Port Datasize="1" Side="right" Name="i2c_sdat" X="0.875" Inout="inout" Datatype="wire" Width="20" Y="0.625" Parent="LM75A_i2c_control2" Height="20" Color="#5f9ea0" Connect="" Function=""/>
 </Module>
 <Port Datasize="1" Side="left" Name="Clk" X="-0.0222222" Inout="input" Datatype="wire" Width="20" Y="0.183333" Parent="LM75A_drive" Height="20" Color="#faebd7" Function=""/>
 <Port Datasize="1" Side="left" Name="Rst_n" X="-0.0222222" Inout="input" Datatype="wire" Width="20" Y="0.383333" Parent="LM75A_drive" Height="20" Color="#00ffff" Function=""/>
 <Port Datasize="1" Side="left" Name="LM75A_EN" X="-0.0222222" Inout="input" Datatype="wire" Width="20" Y="0.583333" Parent="LM75A_drive" Height="20" Color="#7fffd4" Function=""/>
 <Port Datasize="8" Side="right" Name="Temp_data" X="0.977778" Inout="output" Datatype="wire" Width="20" Y="0.15" Parent="LM75A_drive" Height="20" Color="#f0ffff" Function=""/>
 <Port Datasize="1" Side="right" Name="Read_temp_en" X="0.977778" Inout="output" Datatype="wire" Width="20" Y="0.316667" Parent="LM75A_drive" Height="20" Color="#f5f5dc" Function=""/>
 <Port Datasize="1" Side="right" Name="LM_SCL" X="0.977778" Inout="output" Datatype="wire" Width="20" Y="0.483333" Parent="LM75A_drive" Height="20" Color="#ffe4c4" Function=""/>
 <Port Datasize="1" Side="right" Name="LM_SDA" X="0.977778" Inout="inout" Datatype="wire" Width="20" Y="0.65" Parent="LM75A_drive" Height="20" Color="#b8860b" Function=""/>
 <Wire Datasize="1" Name="LM75A_drive_Clk" Datatype="wire" From="LM75A_drive>Clk" Parent="LM75A_drive" To="LM75A_drive#Read_clock_of_LM75A1>Clk"/>
 <Wire Datasize="1" Name="LM75A_drive_Rst_n" Datatype="wire" From="LM75A_drive>Rst_n" Parent="LM75A_drive" To="LM75A_drive#Read_clock_of_LM75A1>Rst_n"/>
 <Wire Datasize="1" Name="LM75A_drive_LM75A_EN" Datatype="wire" From="LM75A_drive>LM75A_EN" Parent="LM75A_drive" To="LM75A_drive#Read_clock_of_LM75A1>LM75A_EN"/>
 <Wire Datasize="1" Name="Read_clock_of_LM75A1_Finish" Datatype="wire" From="LM75A_drive#Read_clock_of_LM75A1>Finish" Parent="LM75A_drive" To="LM75A_drive#LM75A_i2c_control2>rdreg_req"/>
 <Wire Datasize="1" Name="LM75A_i2c_control2_Rst_n" Datatype="wire" From="LM75A_drive#LM75A_i2c_control2>Rst_n" Parent="LM75A_drive" To="LM75A_drive>Rst_n"/>
 <Wire Datasize="1" Name="LM75A_i2c_control2_Clk" Datatype="wire" From="LM75A_drive#LM75A_i2c_control2>Clk" Parent="LM75A_drive" To="LM75A_drive>Clk"/>
 <Wire Datasize="1" Name="LM75A_i2c_control2_RW_Done" Datatype="wire" From="LM75A_drive#LM75A_i2c_control2>RW_Done" Parent="LM75A_drive" To="LM75A_drive>Read_temp_en"/>
 <Wire Datasize="8" Name="LM75A_i2c_control2_rddata" Datatype="wire" From="LM75A_drive#LM75A_i2c_control2>rddata" Parent="LM75A_drive" To="LM75A_drive>Temp_data"/>
 <Wire Datasize="1" Name="LM75A_i2c_control2_i2c_sclk" Datatype="wire" From="LM75A_drive#LM75A_i2c_control2>i2c_sclk" Parent="LM75A_drive" To="LM75A_drive>LM_SCL"/>
 <Wire Datasize="1" Name="LM75A_i2c_control2_i2c_sdat" Datatype="wire" From="LM75A_drive#LM75A_i2c_control2>i2c_sdat" Parent="LM75A_drive" To="LM75A_drive>LM_SDA"/>
</Module>
