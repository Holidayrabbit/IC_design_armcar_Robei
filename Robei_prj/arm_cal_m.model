<!DOCTYPE Robei>
<Module X="0" Parameters="" Color="#d3d3d3" Include="" File="Current/arm_cal_m.model" Width="900" Comment="" Code="&#x9;parameter DATA_WIDTH = 80;&#xa;&#x9;parameter fill_data = 8'h55;//55&#xa;&#x9;parameter delta_angle_low = 8'h1a;//每次变化角度5°对1来说太大了1应该就&#xa;&#x9;parameter delta_angle_heigh = 8'h00;&#xa;&#x9;reg [DATA_WIDTH-1:0] reg_out_data;&#xa;&#x9;reg [7:0] angle_low [5:0];&#xa;&#x9;reg [7:0] angle_heigh [5:0];&#xa;&#x9;reg [7:0] reg_cal;////////////////&#xa;&#x9;reg [7:0] med_angle;&#xa;&#x9;reg [7:0] in_low;&#xa;&#x9;reg [7:0] in_heigh;&#xa;&#x9;reg [7:0] reg_id;&#xa;&#x9;reg [7:0] send_id;&#xa;&#x9;reg run_valid;&#xa;&#x9;integer i;&#xa;&#x9;//时间定义&#xa;&#x9;reg [7:0] time_low;&#xa;&#x9;reg [7:0] time_heigh;&#xa;&#x9;reg reg_input_cmd;&#xa;&#x9;&#xa;&#x9;localparam S0 = 0;&#x9;//等待发送请求&#xa;&#x9;localparam S1 = 1;&#x9;//计算数据发送&#xa;&#x9;localparam S2 = 2;&#x9;//等待单字节数据发送完成&#xa;&#x9;localparam S3 = 3;&#x9;//检查所有数据是否发送完成&#xa;&#x9;reg [7:0] Rst_length;&#xa;&#x9;reg [1:0] state_cal;&#xa;&#x9;reg [3:0] delay;&#xa;&#x9;reg done_reg;&#xa;&#x9;always @(posedge Clk or negedge Rst_n)&#xa;&#x9;begin&#xa;&#x9;if (!Rst_n)&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;angle_low[0] &lt;= 8'hE9;&#xa;&#x9;&#x9;angle_heigh[0] &lt;= 8'h00;&#xa;&#x9;&#x9;angle_low[1] &lt;= 8'hFA;&#xa;&#x9;&#x9;angle_heigh[1] &lt;= 8'h01;&#xa;&#x9;&#x9;angle_low[2] &lt;= 8'h92;&#xa;&#x9;&#x9;angle_heigh[2] &lt;= 8'h00;&#xa;&#x9;&#x9;angle_low[3] &lt;= 8'h6a;&#xa;&#x9;&#x9;angle_heigh[3] &lt;= 8'h03;&#xa;&#x9;&#x9;angle_low[4] &lt;= 8'h08;&#xa;&#x9;&#x9;angle_heigh[4] &lt;= 8'h02;&#xa;&#x9;&#x9;angle_low[5] &lt;= 8'hF4;&#xa;&#x9;&#x9;angle_heigh[5] &lt;= 8'h01;&#xa;&#x9;&#x9;med_angle &lt;= 8'h0;&#xa;&#x9;&#x9;in_low &lt;= 8'h0;&#xa;&#x9;&#x9;in_heigh &lt;= 8'h0;&#xa;&#x9;&#x9;reg_id &lt;= 8'h0;&#xa;&#x9;&#x9;reg_input_cmd &lt;= 1'h0;&#xa;&#x9;&#x9;send_id &lt;= 8'h0;&#xa;&#x9;&#x9;state_cal &lt;= S0;&#xa;&#x9;&#x9;reg_cal &lt;= 8'h0;&#xa;&#x9;&#x9;Rst_length &lt;= 8'h01;&#xa;&#x9;&#x9;delay &lt;= 4'h04;&#xa;&#x9;&#x9;done_reg &lt;= 1'h0;&#xa;&#x9;&#x9;end&#xa;&#x9;else&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;case(state_cal)&#xa;&#x9;&#x9;S0://等待接收&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;if(input_id != 8'h0)&#xa;&#x9;&#x9;&#x9;&#x9;begin&#xa;                Rst_length &lt;= 8'h01;&#xa;&#x9;&#x9;&#x9;&#x9;state_cal &lt;= S1;&#xa;&#x9;&#x9;&#x9;&#x9;reg_id &lt;= input_id;&#xa;&#x9;&#x9;&#x9;&#x9;reg_input_cmd &lt;= input_cmd;&#xa;&#x9;&#x9;&#x9;&#x9;time_low = 8'hf4;//高速&#xa;                time_heigh =8'h00; //高速&#xa;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;    else&#xa;&#x9;&#x9;&#x9;&#x9;state_cal &lt;= S0;&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;S1://分类&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;case(reg_id)&#xa;&#x9;&#x9;&#x9;&#x9;8'h1://舵机1&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[0];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[0]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if (reg_input_cmd)  //加法 ??????????阻塞or非阻塞,顺时针&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[0],angle_heigh[0]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[0],angle_heigh[0]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[0];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[0]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;8'h2://舵机2&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[1];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[1]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if (reg_input_cmd) &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[1],angle_heigh[1]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[1],angle_heigh[1]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[1];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[1]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;8'h3://舵机3&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[2];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[2]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if (reg_input_cmd)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[2],angle_heigh[2]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[2],angle_heigh[2]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[2];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[2];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;8'h4://舵机4&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[3];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[3]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if (reg_input_cmd) &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[3],angle_heigh[3]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[3],angle_heigh[3]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[3];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[3];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;8'h5://舵机5&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[4];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[4]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if (reg_input_cmd)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[4],angle_heigh[4]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[4],angle_heigh[4]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[4];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[4];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;8'h6://舵机6&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low = angle_low[5];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh = angle_heigh[5]; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;if (reg_input_cmd)&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;add_model(in_low,in_heigh,angle_low[5],angle_heigh[5]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;else &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;sub_model(in_low,in_heigh,angle_low[5],angle_heigh[5]);&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= angle_low[5];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= angle_heigh[5];&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= reg_id; &#xa;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;&#x9;8'h7://一步复位&#xa;&#x9;&#x9;&#x9;&#x9;    begin&#xa;                    send_id &lt;= Rst_length;&#xa;//&#x9;&#x9;&#x9;&#x9;        time_low &lt;= 8'h30;&#xa;//                      time_heigh &lt;= 8'h01;&#xa;                    case (Rst_length)&#xa;                        8'h6:&#xa;                            begin&#xa;                            in_low &lt;= 8'hf4;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[5] &lt;= 8'hf4;&#xa;                            angle_heigh[5] &lt;= 8'h01;&#xa;                            end &#xa;                        8'h5:&#xa;                            begin&#xa;                            in_low &lt;= 8'h08;&#xa;                            in_heigh &lt;= 8'h02;&#xa;                            angle_low[4] &lt;= 8'h08;&#xa;                            angle_heigh[4] &lt;=8'h02;&#xa;                            end &#xa;                        8'h4:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfe;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[3] &lt;= 8'hfe;&#xa;                            angle_heigh[3] &lt;=8'h01;&#xa;                            end &#xa;                        8'h3:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfe;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[2] &lt;= 8'hfe;&#xa;                            angle_heigh[2] &lt;=8'h01;&#xa;                            end &#xa;                        8'h2:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfa;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[1] &lt;= 8'hfa;&#xa;                            angle_heigh[1] &lt;=8'h01;&#xa;                            end &#xa;                        8'h1://不动抓取&#xa;                            begin&#xa;                            send_id &lt;= 8'h0;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            begin&#xa;                            in_low &lt;= 8'h0;&#xa;                            in_heigh &lt;= 8'h0;&#xa;                            send_id &lt;= 8'h0;&#xa;                            end&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;&#x9;    /////////////////////////////////////////&#xa;&#x9;&#x9;&#x9;    8'h8://缩姿态&#xa;&#x9;&#x9;&#x9;        begin&#xa;&#x9;&#x9;&#x9;        send_id &lt;= Rst_length;&#xa;                    time_low &lt;= 8'h30;&#xa;                    time_heigh &lt;= 8'h01; &#xa;                    case (Rst_length)&#xa;                        8'h06:&#xa;                            begin&#xa;                            if (reg_input_cmd)&#xa;                                begin&#xa;                                in_low &lt;= 8'h6e;&#xa;                                in_heigh &lt;= 8'h00;&#xa;                                angle_low[5] &lt;= 8'h6e;&#xa;                                angle_heigh[5] &lt;= 8'h00;&#xa;                                end&#xa;                            else&#xa;                                begin&#xa;                                in_low &lt;= 8'h60;&#xa;                                in_heigh &lt;= 8'h03;&#xa;                                angle_low[5] &lt;= 8'h60;&#xa;                                angle_heigh[5] &lt;= 8'h03;&#xa;                                end&#xa;                            end &#xa;                        8'h05:&#xa;                            begin&#xa;                            in_low &lt;= 8'h82;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[4] &lt;= 8'h82;&#xa;                            angle_heigh[4] &lt;=8'h00;&#xa;                            end &#xa;                        8'h04:&#xa;                            begin&#xa;                            in_low &lt;= 8'h44;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[3] &lt;= 8'h44;&#xa;                            angle_heigh[3] &lt;=8'h00;&#xa;                            end &#xa;                        8'h03:&#xa;                            begin&#xa;                            in_low &lt;= 8'h44;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[2] &lt;= 8'h44;&#xa;                            angle_heigh[2] &lt;= 8'h00;&#xa;                            end &#xa;                        8'h02:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfa;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[1] &lt;= 8'hfa;&#xa;                            angle_heigh[1] &lt;= 8'h01;&#xa;                            end &#xa;                        8'h01:&#xa;                            begin&#xa;                            in_low &lt;= 8'hb5;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[0] &lt;= 8'hb5;&#xa;                            angle_heigh[0] &lt;=8'h00;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            send_id &lt;= 8'h07;&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;        end&#xa;&#x9;&#x9;&#x9;    8'h9://伸姿态&#xa;&#x9;&#x9;&#x9;        begin&#xa;&#x9;&#x9;&#x9;        send_id &lt;= Rst_length;&#xa;                    time_low &lt;= 8'h30;&#xa;                    time_heigh &lt;= 8'h01; &#xa;                    case (Rst_length)&#xa;                        8'h6:&#xa;                            begin&#xa;                            if (reg_input_cmd)&#xa;                                begin&#xa;                                in_low &lt;= 8'h6e;&#xa;                                in_heigh &lt;= 8'h00;&#xa;                                angle_low[5] &lt;= 8'h6e;&#xa;                                angle_heigh[5] &lt;=8'h00;&#xa;                                end&#xa;                            else&#xa;                                begin&#xa;                                in_low &lt;= 8'h60;&#xa;                                in_heigh &lt;= 8'h03;&#xa;                                angle_low[5] &lt;= 8'h60;&#xa;                                angle_heigh[5] &lt;=8'h03;&#xa;                                end&#xa;                            end &#xa;                        8'h5:&#xa;                            begin&#xa;                            in_low &lt;= 8'he6;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[4] &lt;= 8'he6;&#xa;                            angle_heigh[4] &lt;=8'h00;&#xa;                            end &#xa;                        8'h4:&#xa;                            begin&#xa;                            in_low &lt;= 8'h14;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[3] &lt;= 8'h14;&#xa;                            angle_heigh[3] &lt;=8'h01;&#xa;                            end &#xa;                        8'h3:&#xa;                            begin&#xa;                            in_low &lt;= 8'he0;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[2] &lt;= 8'he0;&#xa;                            angle_heigh[2] &lt;=8'h00;&#xa;                            end &#xa;                        8'h2:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfa;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[1] &lt;= 8'hfa;&#xa;                            angle_heigh[1] &lt;=8'h01;&#xa;                            end &#xa;                        8'h1:&#xa;                            begin&#xa;                            in_low &lt;= 8'hd3;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[0] &lt;= 8'hd3;&#xa;                            angle_heigh[0] &lt;=8'h01;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            send_id &lt;= 8'h07;&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;        end&#xa;&#x9;&#x9;&#x9;    8'h0a://鞠躬/抓取姿态&#xa;&#x9;&#x9;&#x9;        begin&#xa;&#x9;&#x9;&#x9;        send_id &lt;= Rst_length;&#xa;&#x9;&#x9;&#x9;&#x9;    time_low &lt;= 8'h30;&#xa;                    time_heigh &lt;= 8'h03;&#xa;                    case (Rst_length)&#xa;                        8'h5:&#xa;                            begin&#xa;                            in_low &lt;= 8'h38;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[4] &lt;= 8'h38;&#xa;                            angle_heigh[4] &lt;=8'h01;&#xa;                            end &#xa;                        8'h4:&#xa;                            begin&#xa;                            in_low &lt;= 8'hce;&#xa;                            in_heigh &lt;= 8'h02;&#xa;                            angle_low[3] &lt;= 8'hce;&#xa;                            angle_heigh[3] &lt;=8'h02;&#xa;                            end &#xa;                        8'h3:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfa;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[2] &lt;= 8'hfa;&#xa;                            angle_heigh[2] &lt;=8'h00;&#xa;                            end &#xa;                        8'h2:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfa;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[1] &lt;= 8'hfa;&#xa;                            angle_heigh[1] &lt;=8'h01;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            send_id &lt;= 8'h07;&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;        end&#xa;&#x9;&#x9;&#x9;    8'h0b://铲人姿态，变时间&#xa;&#x9;&#x9;&#x9;        begin&#xa;                    send_id &lt;= Rst_length;&#xa;&#x9;&#x9;&#x9;&#x9;    time_low &lt;= 8'h30;&#xa;                    time_heigh &lt;= 8'h03;&#xa;                    case (Rst_length)&#xa;                        8'h6:&#xa;                            begin&#xa;                            in_low &lt;= 8'hf4;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[5] &lt;= 8'hf4;&#xa;                            angle_heigh[5] &lt;= 8'h01;&#xa;                            end &#xa;                        8'h5:&#xa;                            begin&#xa;                            in_low &lt;= 8'hd0;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[4] &lt;= 8'hd0;&#xa;                            angle_heigh[4] &lt;=8'h00;&#xa;                            end &#xa;                        8'h4:&#xa;                            begin&#xa;                            in_low &lt;= 8'h84;&#xa;                            in_heigh &lt;= 8'h03;&#xa;                            angle_low[3] &lt;= 8'h84;&#xa;                            angle_heigh[3] &lt;=8'h03;&#xa;                            end &#xa;                        8'h3:&#xa;                            begin&#xa;                            in_low &lt;= 8'hb4;&#xa;                            in_heigh &lt;= 8'h02;&#xa;                            angle_low[2] &lt;= 8'hb4;&#xa;                            angle_heigh[2] &lt;=8'h02;&#xa;                            end &#xa;                        8'h2:&#xa;                            begin&#xa;                            in_low &lt;= 8'he0;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[1] &lt;= 8'he0;&#xa;                            angle_heigh[1] &lt;=8'h01;&#xa;                            end &#xa;                        8'h1:&#xa;                            begin&#xa;                            in_low &lt;= 8'hd3;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[0] &lt;= 8'hd3;&#xa;                            angle_heigh[0] &lt;= 8'h01;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            begin&#xa;                            in_low &lt;= 8'h0;&#xa;                            in_heigh &lt;= 8'h0;&#xa;                            send_id &lt;= 8'h0;&#xa;                            end&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;    8'h0c://远敲击,不动抓取&#xa;&#x9;&#x9;&#x9;        begin&#xa;                    send_id &lt;= Rst_length;&#xa;                    case (Rst_length)&#xa;                        8'h5:&#xa;                            begin&#xa;                            in_low &lt;= 8'h3c;&#xa;                            in_heigh &lt;= 8'h02;&#xa;                            angle_low[4] &lt;= 8'h3c;&#xa;                            angle_heigh[4] &lt;=8'h02;&#xa;                            end &#xa;                        8'h4:&#xa;                            begin&#xa;                            in_low &lt;= 8'hfe;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[3] &lt;= 8'hfe;&#xa;                            angle_heigh[3] &lt;=8'h01;&#xa;                            end &#xa;                        8'h3:&#xa;                            begin&#xa;                            in_low &lt;= 8'h3c;&#xa;                            in_heigh &lt;= 8'h02;&#xa;                            angle_low[2] &lt;= 8'h3c;&#xa;                            angle_heigh[2] &lt;=8'h02;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            begin&#xa;                            in_low &lt;= 8'h0;&#xa;                            in_heigh &lt;= 8'h0;&#xa;                            send_id &lt;= 8'h0;&#xa;                            end&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;    8'h0d://肘击，不动抓取，未修改&#xa;&#x9;&#x9;&#x9;        begin&#xa;                    send_id &lt;= Rst_length;&#xa;//&#x9;&#x9;&#x9;&#x9;        time_low &lt;= 8'h30;&#xa;//                      time_heigh &lt;= 8'h01;&#xa;                    case (Rst_length)&#xa;                        8'h6:&#xa;                            begin&#xa;                            in_low &lt;= 8'hf4;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[4] &lt;= 8'hf4;&#xa;                            angle_heigh[4] &lt;=8'h01;&#xa;                            end &#xa;                        8'h5:&#xa;                            begin&#xa;                            in_low &lt;= 8'h1e;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[4] &lt;= 8'h1e;&#xa;                            angle_heigh[4] &lt;=8'h01;&#xa;                            end &#xa;                        8'h4:&#xa;                            begin&#xa;                            in_low &lt;= 8'hb4;&#xa;                            in_heigh &lt;= 8'h02;&#xa;                            angle_low[3] &lt;= 8'hb4;&#xa;                            angle_heigh[3] &lt;=8'h02;&#xa;                            end &#xa;                        8'h3:&#xa;                            begin&#xa;                            in_low &lt;= 8'hb8;&#xa;                            in_heigh &lt;= 8'h03;&#xa;                            angle_low[2] &lt;= 8'hb8;&#xa;                            angle_heigh[2] &lt;=8'h03;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            begin&#xa;                            in_low &lt;= 8'h0;&#xa;                            in_heigh &lt;= 8'h0;&#xa;                            send_id &lt;= 8'h0;&#xa;                            end&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;&#x9;8'h0e://防御姿态&#xa;&#x9;&#x9;&#x9;&#x9;    begin&#xa;                    send_id &lt;= Rst_length;&#xa;                    case (Rst_length)&#xa;                        8'h6:&#xa;                            begin&#xa;                            if ((angle_low[5] ==8'hf4)&amp;&amp;(angle_heigh[5] &lt;= 8'h01))&#xa;                                begin&#xa;                                in_low &lt;= 8'h72;&#xa;                                in_heigh &lt;= 8'h01;&#xa;                                angle_low[5] &lt;= 8'h72;&#xa;                                angle_heigh[5] &lt;= 8'h01;&#xa;                                end&#xa;                            else if((angle_low[5] ==8'h72)&amp;&amp;(angle_heigh[5] &lt;= 8'h01))&#xa;                                begin&#xa;                                in_low &lt;= 8'h90;&#xa;                                in_heigh &lt;= 8'h02;&#xa;                                angle_low[5] &lt;= 8'h90;&#xa;                                angle_heigh[5] &lt;= 8'h02;&#xa;                                end&#xa;                            else&#xa;                                begin&#xa;                                in_low &lt;= 8'hf4;&#xa;                                in_heigh &lt;= 8'h01;&#xa;                                angle_low[5] &lt;= 8'hf4;&#xa;                                angle_heigh[5] &lt;= 8'h01;&#xa;                                end&#xa;                            end &#xa;                        8'h5:&#xa;                            begin&#xa;                            in_low &lt;= 8'h0c;&#xa;                            in_heigh &lt;= 8'h03;&#xa;                            angle_low[4] &lt;= 8'h0c;&#xa;                            angle_heigh[4] &lt;=8'h03;&#xa;                            end &#xa;                        8'h4:&#xa;                            begin&#xa;                            in_low &lt;= 8'h62;&#xa;                            in_heigh &lt;= 8'h01;&#xa;                            angle_low[3] &lt;= 8'h62;&#xa;                            angle_heigh[3] &lt;=8'h01;&#xa;                            end &#xa;                        8'h3:&#xa;                            begin&#xa;                            in_low &lt;= 8'h78;&#xa;                            in_heigh &lt;= 8'h00;&#xa;                            angle_low[2] &lt;= 8'h78;&#xa;                            angle_heigh[2] &lt;=8'h00;&#xa;                            end &#xa;                        default:&#x9;&#xa;                            begin&#xa;                            in_low &lt;= 8'h0;&#xa;                            in_heigh &lt;= 8'h0;&#xa;                            send_id &lt;= 8'h0;&#xa;                            end&#xa;                    endcase&#xa;                    Rst_length &lt;= Rst_length + 8'h1;&#xa;&#x9;&#x9;&#x9;&#x9;    end&#xa;&#x9;&#x9;&#x9;&#x9;default:&#x9;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_low &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in_heigh &lt;= 8'h0;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;send_id &lt;= 8'h07;&#xa;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;&#x9;endcase&#xa;&#x9;&#x9;&#x9;state_cal &lt;= S2;&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;S2://发送&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;data_out[79:72] &lt;= fill_data; // 0101 0101&#xa;&#x9;&#x9;&#x9;data_out[71:64] &lt;= fill_data;// 0101 0101&#xa;&#x9;&#x9;&#x9;data_out[63:56] &lt;= send_id;//reg_id&#xa;&#x9;&#x9;&#x9;data_out[55:48] &lt;= 8'h07;//8'h7&#xa;&#x9;&#x9;&#x9;data_out[47:40] &lt;= 8'h01;//8'h1&#xa;&#x9;&#x9;&#x9;data_out[39:32] &lt;= in_low;//in_low&#xa;&#x9;&#x9;&#x9;data_out[31:24] &lt;= in_heigh;//in_heigh&#xa;&#x9;&#x9;&#x9;data_out[23:16] &lt;= time_low;//time_low&#xa;&#x9;&#x9;&#x9;data_out[15:8] &lt;= time_heigh;//time_heigh&#xa;&#x9;&#x9;&#x9;data_out[7:0] = (8'hff-(send_id+8'h07+8'h01+in_heigh+in_low+time_heigh+time_low));//reg_cal&#xa;&#x9;&#x9;&#x9;state_cal &lt;= S3;&#xa;&#x9;&#x9;&#x9;send_en_out &lt;= 1'b1;&#xa;&#x9;&#x9;&#x9;end&#xa;&#x9;&#x9;S3://等待发送完毕&#xa;&#x9;&#x9;&#x9;begin&#xa;&#x9;&#x9;&#x9;send_en_out &lt;= 1'b0;&#xa;            if (Tx_Done_flag == 1 | done_reg == 1)&#xa;                begin&#xa;                done_reg &lt;= 1'h1;&#xa;                if (delay == 4'h0)&#xa;                    begin&#xa;                    delay &lt;= 4'h04;&#xa;                    done_reg &lt;= 1'h00;&#xa;                    if (reg_id > 8'h06 &amp;&amp; Rst_length != 8'h07)&#xa;                        state_cal &lt;= S1;&#xa;                    else&#xa;                        state_cal &lt;= S0;&#xa;                    end&#xa;                else&#xa;                    delay &lt;= delay - 4'h1;&#xa;                end&#xa;            end&#xa;&#x9;&#x9;endcase&#xa;&#x9;&#x9;end &#xa;&#x9;end&#xa;&#x9;&#xa;//&#x9;reg return_valid;&#xa;//&#x9;//返回接受有效信号&#xa;//&#x9;always @(posedge Clk or negedge Rst_n)&#xa;//&#x9;begin&#xa;//&#x9;if(!Rst_n)&#xa;//&#x9;&#x9;return_valid &lt;= 1'b0;&#xa;//&#x9;else&#xa;//&#x9;&#x9;begin&#xa;//&#x9;&#x9;if(input_id != 8'h0)&#xa;//&#x9;&#x9;&#x9;return_valid &lt;= 1'b1;&#xa;//&#x9;&#x9;else&#xa;//&#x9;&#x9;&#x9;return_valid &lt;= 1'b0;&#xa;//&#x9;&#x9;end&#xa;//&#x9;end&#xa;&#x9;&#xa;&#x9;task add_model;&#xa;&#x9;&#x9;input [7:0] angle_low_tr;&#xa;&#x9;&#x9;input [7:0] angle_heigh_tr;&#xa;&#x9;&#x9;output [7:0] a_low;&#xa;&#x9;&#x9;output [7:0] a_heigh;&#xa;&#x9;&#x9;begin//加法 ??????????阻塞or非阻塞&#xa;&#x9;&#x9;med_angle = 8'h0;&#xa;&#x9;&#x9;a_low = delta_angle_low + angle_low_tr;&#xa;&#x9;&#x9;med_angle = angle_heigh_tr;&#xa;&#x9;&#x9;if (a_low &lt; angle_low_tr)&#xa;&#x9;&#x9;&#x9;med_angle = angle_heigh_tr + 8'h01;&#xa;&#x9;&#x9;a_heigh = med_angle + delta_angle_heigh;&#xa;&#x9;&#x9;med_angle = 8'h0;&#xa;&#x9;&#x9;end&#xa;&#x9;endtask&#xa;&#x9;&#xa;&#x9;task sub_model;&#xa;&#x9;&#x9;input [7:0] angle_low_tr;&#xa;&#x9;&#x9;input [7:0] angle_heigh_tr;&#xa;&#x9;&#x9;output [7:0] a_low;&#xa;&#x9;&#x9;output [7:0] a_heigh;&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;med_angle = 8'h0;&#xa;&#x9;&#x9;if (angle_heigh_tr &lt; delta_angle_heigh)&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;  a_low = 8'h0; &#xa;&#x9;&#x9;  a_heigh = 8'h0;&#xa;&#x9;&#x9;end&#xa;&#x9;&#x9;else&#xa;&#x9;&#x9;begin&#xa;&#x9;&#x9;  if (delta_angle_low &lt;= angle_low_tr)&#xa;&#x9;&#x9;  begin&#xa;&#x9;&#x9;&#x9; a_low = angle_low_tr - delta_angle_low;&#xa;&#x9;&#x9;&#x9; a_heigh = angle_heigh_tr - delta_angle_heigh;&#xa;&#x9;      end&#xa;&#x9;&#x9;  else &#xa;&#x9;&#x9;  begin&#xa;&#x9;&#x9;&#x9; if (angle_heigh_tr == delta_angle_heigh)&#xa;&#x9;&#x9;&#x9; begin&#xa;&#x9;&#x9;&#x9;     a_low = 8'h0; &#xa;&#x9;&#x9;&#x9;     a_heigh = 8'h0;&#xa;&#x9;&#x9;&#x9; end&#xa;&#x9;&#x9;&#x9; else&#xa;&#x9;&#x9;&#x9; begin&#xa;&#x9;&#x9;&#x9;     a_heigh = angle_heigh_tr - delta_angle_heigh - 8'h1;&#xa;&#x9;&#x9;&#x9;     a_low = ~(delta_angle_low-angle_low_tr)+8'h1;&#xa;&#x9;&#x9;&#x9; end&#xa;&#x9;&#x9;  end&#xa;&#x9;&#x9;end&#xa;&#xa;   &#x9;&#x9;end&#xa;&#x9;endtask " Name="arm_cal_m" Y="0" Type="module" Parent="0" Height="600" Class="module">
 <Port X="-0.0222222" Side="left" Datatype="wire" Inout="input" Function="" Color="#faebd7" Width="20" Name="Clk" Y="0.125" Parent="arm_cal_m" Height="20" Datasize="1"/>
 <Port X="-0.0222222" Side="left" Datatype="wire" Inout="input" Function="" Color="#00ffff" Width="20" Name="Rst_n" Y="0.266667" Parent="arm_cal_m" Height="20" Datasize="1"/>
 <Port X="-0.0222222" Side="left" Datatype="wire" Inout="input" Function="" Color="#7fffd4" Width="20" Name="input_cmd" Y="0.55" Parent="arm_cal_m" Height="20" Datasize="1"/>
 <Port X="0.977778" Side="right" Datatype="reg" Inout="output" Function="" Color="#a52a2a" Width="20" Name="data_out" Y="0.233333" Parent="arm_cal_m" Height="20" Datasize="80"/>
 <Port X="0.977778" Side="right" Datatype="reg" Inout="output" Function="" Color="#f5f5dc" Width="20" Name="send_en_out" Y="0.483333" Parent="arm_cal_m" Height="20" Datasize="1"/>
 <Port X="-0.0222222" Side="left" Datatype="wire" Inout="input" Function="" Color="#ffe4c4" Width="20" Name="input_id" Y="0.408333" Parent="arm_cal_m" Height="20" Datasize="8"/>
 <Port X="-0.0222222" Side="left" Datatype="wire" Inout="input" Function="" Color="#b8860b" Width="20" Name="Tx_Done_flag" Y="0.691667" Parent="arm_cal_m" Height="20" Datasize="1"/>
</Module>
