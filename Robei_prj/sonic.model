<!DOCTYPE Robei>
<Module Code="&#x9;    parameter SYS_CLK=33_333_333;&#xa;&#x9;    parameter CLK_17KHz=17_000;&#xa;&#x9;    parameter CNT_300MS=10_000_000;&#xa;&#x9;    parameter CNT_15US=500;&#xa;&#x9;    localparam CNT_17K=SYS_CLK/CLK_17KHz;&#xa;&#x9;    &#xa;&#x9;    wire nege_Echo;&#xa;&#x9;    wire pose_Echo;&#xa;&#x9;&#xa;&#x9;    reg  Echo_delay0;&#xa;&#x9;    reg  Echo_delay1;&#xa;&#x9;    reg [23:0] cnt_300ms;&#xa;&#x9;    reg [10:0] cnt_17K;&#xa;&#x9;    (* mark_debug=1 *)reg cnt_17K_en;&#xa;&#x9;    reg [15:0] data_length;&#xa;&#x9;    &#xa;&#x9;    assign pose_Echo = (~Echo_delay1&amp;&amp;Echo_delay0);&#xa;&#x9;    assign nege_Echo = Echo_delay1&amp;&amp;(!Echo_delay0);&#xa;&#x9;    &#xa;&#x9;    //Echo_delay&#xa;&#x9;    always @(posedge sys_clk or negedge rst_n)begin&#xa;&#x9;        if(!rst_n)begin&#xa;&#x9;            Echo_delay0&lt;=0;&#xa;&#x9;            Echo_delay0&lt;=1;&#xa;&#x9;        end&#xa;&#x9;        else begin&#xa;&#x9;            Echo_delay0&lt;=Echo;&#xa;&#x9;            Echo_delay1&lt;=Echo_delay0;&#xa;&#x9;        end         &#xa;&#x9;    end&#xa;&#x9;    &#xa;&#x9;    //cnt_300ms&#xa;&#x9;    always@ (posedge sys_clk or negedge rst_n)begin&#xa;&#x9;        if(!rst_n)&#xa;&#x9;            cnt_300ms&lt;=24'b0;&#xa;&#x9;        else if(cnt_300ms==CNT_300MS-1)&#xa;&#x9;            cnt_300ms&lt;=24'b0;&#xa;&#x9;        else&#xa;&#x9;            cnt_300ms&lt;=cnt_300ms+1;&#xa;&#x9;    end&#xa;&#x9;    &#xa;&#x9;    //trig&#xa;&#x9;    always@ (posedge sys_clk or negedge rst_n)begin&#xa;&#x9;        if(!rst_n)&#xa;&#x9;            trig&lt;=0;&#xa;&#x9;        else if(cnt_300ms&lt;=CNT_15US)&#xa;&#x9;            trig&lt;=1;&#xa;&#x9;        else &#xa;&#x9;            trig&lt;=0;&#xa;&#x9;    end&#xa;&#x9;    &#xa;&#x9;    //cnt_17K_en&#xa;&#x9;    always@(posedge sys_clk or negedge rst_n)begin&#xa;&#x9;        if(!rst_n)&#xa;&#x9;            cnt_17K_en&lt;=0;&#xa;&#x9;        else if(pose_Echo)&#xa;&#x9;            cnt_17K_en&lt;=1;&#xa;&#x9;        else if(nege_Echo)&#xa;&#x9;            cnt_17K_en&lt;=0;&#xa;&#x9;    end&#xa;&#x9;    &#xa;&#x9;    //cnt_17K&#xa;&#x9;    always@ (posedge sys_clk or negedge rst_n)begin&#xa;&#x9;        if(!rst_n)&#xa;&#x9;            cnt_17K&lt;=11'b0;&#xa;&#x9;        else if(cnt_17K_en)&#xa;&#x9;            if(cnt_17K==CNT_17K)&#xa;&#x9;                cnt_17K&lt;=11'b0;&#xa;&#x9;            else&#xa;&#x9;                cnt_17K&lt;=cnt_17K+1;&#xa;&#x9;        else&#xa;&#x9;            cnt_17K&lt;=11'b0;&#xa;&#x9;    end&#xa;&#x9;    &#xa;&#x9;    //data_r&#xa;&#x9;    always@ (posedge sys_clk or negedge rst_n)begin&#xa;&#x9;        if(!rst_n)&#xa;&#x9;            data_length&lt;=10'b0;&#xa;&#x9;        else if(cnt_17K_en)&#xa;&#x9;            if(cnt_17K==CNT_17K)&#xa;&#x9;                data_length&lt;=data_length+1;&#xa;&#x9;            else&#xa;&#x9;                data_length&lt;=data_length;&#xa;&#x9;        else if(cnt_300ms==24'd1)&#xa;&#x9;            data_length&lt;=10'b0;   &#xa;&#x9;        else&#xa;&#x9;            data_length&lt;=data_length;                  &#xa;&#x9;    end&#xa;&#x9;&#x9;&#x9;    //BEEP&#xa;&#x9;&#x9;    always@ (posedge sys_clk or negedge rst_n)begin&#xa;&#x9;&#x9;        if(!rst_n)&#xa;&#x9;&#x9;            BEEP&lt;=1'b0;&#xa;&#x9;&#x9;        else if(data_length&lt;=6)&#xa;&#x9;                BEEP&lt;=1'b1;&#xa;&#x9;&#x9;        else &#xa;&#x9;&#x9;            BEEP&lt;=1'b0; &#xa;&#x9;            &#xa;&#x9;&#x9;    end&#xa;&#x9;&#xa;&#x9;  /*  &#xa;&#x9;    //data&#xa;&#x9;    always@ (posedge sys_clk or negedge rst_n)begin&#xa;&#x9;        if(!rst_n)begin&#xa;&#x9;            data&lt;=0;&#xa;&#x9;&#xa;&#x9;        end&#xa;&#x9;        else if(cnt_300ms==CNT_300MS-1)begin&#xa;&#x9;            data&lt;=data_length;&#xa;&#x9;&#xa;&#x9;        end&#xa;&#x9;        else begin&#xa;&#x9;            data&lt;=data;&#xa;&#x9;&#xa;&#x9;        end &#xa;&#x9;         &#xa;&#x9;    end&#xa;&#x9;*/" Width="900" Height="600" Y="0" Comment="" Class="module" Color="#d3d3d3" Include="" Parameters="" Name="sonic" Type="module" File="Current/sonic.model" Parent="0" X="0">
 <Port Datatype="wire" Width="20" Height="20" Y="0.183333" Datasize="1" Inout="input" Color="#ff0000" Function="" Name="sys_clk" Side="left" Parent="sonic" X="-0.0222222"/>
 <Port Datatype="wire" Width="20" Height="20" Y="0.383333" Datasize="1" Inout="input" Color="#ffff00" Function="" Name="rst_n" Side="left" Parent="sonic" X="-0.0222222"/>
 <Port Datatype="wire" Width="20" Height="20" Y="0.583333" Datasize="1" Inout="input" Color="#0000ff" Function="" Name="Echo" Side="left" Parent="sonic" X="-0.0222222"/>
 <Port Datatype="reg" Width="20" Height="20" Y="0.233333" Datasize="1" Inout="output" Color="#008000" Function="" Name="trig" Side="right" Parent="sonic" X="0.977778"/>
 <Port Datatype="reg" Width="20" Height="20" Y="0.483333" Datasize="1" Inout="output" Color="#ffe4c4" Function="" Name="BEEP" Side="right" Parent="sonic" X="0.977778"/>
</Module>
